<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="SemidÃ¡n Robaina" /><link rel="canonical" href="https://robaina.github.io/MetaTag/references/api/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>API references - MetaTag</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API references";
        var mkdocs_page_input_path = "references/api.md";
        var mkdocs_page_url = "/MetaTag/references/api/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MetaTag
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Subcommands</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/preprocess/">Preprocess</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/database/">Database</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/tree/">Tree</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/place/">Place</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/assign/">Assign</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/count/">Count</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/plot/">Plot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../subcommands/relabel/">Relabel</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">References</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">API references</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MetaTag</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>References &raquo;</li>
      <li>API references</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Robaina/MetaTag/edit/master/docs/references/api.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="module-pipelines">Module pipelines</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.pipelines"></a>
  <div class="doc doc-contents first">
  
      <p>Pre-set pipelines to infer trees and place and label env sequences</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.metatag.pipelines.QueryLabeller" class="doc doc-heading">
        <code>QueryLabeller</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Place queries onto reference tree and assign function and taxonomy</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">QueryLabeller</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Place queries onto reference tree and assign function and taxonomy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_query</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">reference_alignment</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">reference_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">reference_labels</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">tree_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tree_clusters</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tree_cluster_scores</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tree_cluster_score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">alignment_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;papara&quot;</span><span class="p">,</span>
        <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maximum_placement_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">distance_measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pendant_diameter_ratio&quot;</span><span class="p">,</span>
        <span class="n">minimum_placement_lwr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place queries onto reference tree and assign function and taxonomy</span>

<span class="sd">        Args:</span>
<span class="sd">            input_query (Path): path to query fasta file</span>
<span class="sd">            reference_alignment (Path): path to reference alignment in FASTA format</span>
<span class="sd">            reference_tree (Path): path to reference tree in Newick format</span>
<span class="sd">            tree_model (str): substitution model to use for tree inference</span>
<span class="sd">            tree_clusters (Path, optional): path to tsv file containing tree cluster</span>
<span class="sd">                definitions. Defaults to None.</span>
<span class="sd">            tree_cluster_scores (Path, optional): path to tsv file containing tree</span>
<span class="sd">                cluster scores. Defaults to None.</span>
<span class="sd">            reference_labels (Path, optional): path to reference labels file in pickle</span>
<span class="sd">                format. Defaults to None.</span>
<span class="sd">            alignment_method (str, optional): choose aligner: &quot;papara&quot; or &quot;hmmalign&quot;.</span>
<span class="sd">                Defaults to &quot;papara&quot;.</span>
<span class="sd">            output_directory (Path, optional): path to output directory.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            maximum_placement_distance (float, optional): maximum distance of placed</span>
<span class="sd">                sequences (distance measure below). Defaults to 1.0.</span>
<span class="sd">            distance_measure (str, optional): choose distance measure for placements:</span>
<span class="sd">                &quot;pendant_diameter_ratio&quot;,</span>
<span class="sd">                &quot;pendant_distal_ratio&quot; or &quot;pendant&quot;. Defaults to &quot;pendant_diameter_ratio&quot;.</span>
<span class="sd">            minimum_placement_lwr (float, optional): cutoff value for the LWR of</span>
<span class="sd">                placements. Defaults to 0.8.</span>
<span class="sd">            logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_query</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_alignment</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_alignment</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_tree</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_tree</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="k">else</span> <span class="n">tree_model</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tree_clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tree_cluster_scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_cluster_scores</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_score_threshold</span> <span class="o">=</span> <span class="n">tree_cluster_score_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_method</span> <span class="o">=</span> <span class="n">alignment_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span> <span class="o">=</span> <span class="n">reference_labels</span>
        <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;placement_results&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="o">=</span> <span class="n">maximum_placement_distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_measure</span> <span class="o">=</span> <span class="n">distance_measure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="o">=</span> <span class="n">minimum_placement_lwr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;query_cleaned.faa&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;query_cleaned_id_dict.pickle&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;placements&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;assignments&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;counts&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.jplace&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.jplace&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_lwr_filtered.jplace&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_distance_filtered.jplace&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_distance_filtered_lwr_filtered.jplace&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_out_placements_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.newick&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_taxtable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span> <span class="o">/</span> <span class="s2">&quot;placed_tax_assignments.tsv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">place_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to directory with placement results.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assign_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to directory with assignment results.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">count_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to directory with count results.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">jplace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to output file with placements in jplace format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">placements_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to output file with placements in Newick format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_placements_tree</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">taxtable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to output file with taxonomic assignments.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_taxtable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">query_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to output file with query labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to logfile.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run pipeline to annotate query sequences through evolutionary placement.&quot;&quot;&quot;</span>
        <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span><span class="p">,</span>
            <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">idprefix</span><span class="o">=</span><span class="s2">&quot;query_&quot;</span><span class="p">,</span>
            <span class="n">export_dup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>

        <span class="n">place_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">aln</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_alignment</span><span class="p">,</span>
            <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_tree</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span><span class="p">,</span>
            <span class="n">aln_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_method</span><span class="p">,</span>
            <span class="n">tree_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">placesequences</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">place_args</span><span class="p">)</span>

        <span class="n">assign_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">jplace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_jplace</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span><span class="p">,</span>
            <span class="n">query_labels</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span><span class="p">],</span>
            <span class="n">ref_clusters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span><span class="p">,</span>
            <span class="n">ref_cluster_scores</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span><span class="p">,</span>
            <span class="n">outgroup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;placed_tax_&quot;</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span><span class="p">,</span>
            <span class="n">max_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span><span class="p">,</span>
            <span class="n">distance_measure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_measure</span><span class="p">,</span>
            <span class="n">minimum_lwr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span><span class="p">,</span>
            <span class="n">duplicated_query_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">labelplacements</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">assign_args</span><span class="p">)</span>

        <span class="n">count_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">taxtable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_taxtable</span><span class="p">,</span>
            <span class="n">taxlevels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">,</span> <span class="s2">&quot;family&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;phylum&quot;</span><span class="p">],</span>
            <span class="n">cluster_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_score_threshold</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span><span class="p">,</span>
            <span class="n">outprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">export_right_queries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">countplacements</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">count_args</span><span class="p">)</span>

        <span class="n">relabel_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_placements_tree</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span><span class="p">],</span>
            <span class="n">labelprefixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ref_&quot;</span><span class="p">,</span> <span class="s2">&quot;query_&quot;</span><span class="p">],</span>
            <span class="n">taxonomy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">aln</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">relabeltree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">relabel_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.assign_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_directory</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to directory with assignment results.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.count_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">count_directory</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to directory with count results.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.jplace" class="doc doc-heading">
<code class="highlight language-python"><span class="n">jplace</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to output file with placements in jplace format.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.logfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to logfile.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.place_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">place_directory</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to directory with placement results.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.placements_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">placements_tree</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to output file with placements in Newick format.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.query_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">query_labels</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to output file with query labels.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryLabeller.taxtable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">taxtable</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Path to output file with taxonomic assignments.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.QueryLabeller.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">input_query</span><span class="p">,</span> <span class="n">reference_alignment</span><span class="p">,</span> <span class="n">reference_tree</span><span class="p">,</span> <span class="n">reference_labels</span><span class="p">,</span> <span class="n">tree_model</span><span class="p">,</span> <span class="n">tree_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_cluster_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_cluster_score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alignment_method</span><span class="o">=</span><span class="s1">&#39;papara&#39;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maximum_placement_distance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">distance_measure</span><span class="o">=</span><span class="s1">&#39;pendant_diameter_ratio&#39;</span><span class="p">,</span> <span class="n">minimum_placement_lwr</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Place queries onto reference tree and assign function and taxonomy</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_query</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_alignment</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference alignment in FASTA format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_tree</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference tree in Newick format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tree_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>substitution model to use for tree inference</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tree_clusters</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv file containing tree cluster
definitions. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>tree_cluster_scores</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv file containing tree
cluster scores. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reference_labels</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference labels file in pickle
format. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>alignment_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose aligner: "papara" or "hmmalign".
Defaults to "papara".</p></td>
          <td>
                <code>&#39;papara&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_directory</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>maximum_placement_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>maximum distance of placed
sequences (distance measure below). Defaults to 1.0.</p></td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
        <tr>
          <td><code>distance_measure</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose distance measure for placements:
"pendant_diameter_ratio",
"pendant_distal_ratio" or "pendant". Defaults to "pendant_diameter_ratio".</p></td>
          <td>
                <code>&#39;pendant_diameter_ratio&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>minimum_placement_lwr</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>cutoff value for the LWR of
placements. Defaults to 0.8.</p></td>
          <td>
                <code>0.8</code>
          </td>
        </tr>
        <tr>
          <td><code>logfile</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to logfile. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_query</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">reference_alignment</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">reference_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">reference_labels</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">tree_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tree_clusters</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tree_cluster_scores</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tree_cluster_score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alignment_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;papara&quot;</span><span class="p">,</span>
    <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maximum_placement_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">distance_measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pendant_diameter_ratio&quot;</span><span class="p">,</span>
    <span class="n">minimum_placement_lwr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Place queries onto reference tree and assign function and taxonomy</span>

<span class="sd">    Args:</span>
<span class="sd">        input_query (Path): path to query fasta file</span>
<span class="sd">        reference_alignment (Path): path to reference alignment in FASTA format</span>
<span class="sd">        reference_tree (Path): path to reference tree in Newick format</span>
<span class="sd">        tree_model (str): substitution model to use for tree inference</span>
<span class="sd">        tree_clusters (Path, optional): path to tsv file containing tree cluster</span>
<span class="sd">            definitions. Defaults to None.</span>
<span class="sd">        tree_cluster_scores (Path, optional): path to tsv file containing tree</span>
<span class="sd">            cluster scores. Defaults to None.</span>
<span class="sd">        reference_labels (Path, optional): path to reference labels file in pickle</span>
<span class="sd">            format. Defaults to None.</span>
<span class="sd">        alignment_method (str, optional): choose aligner: &quot;papara&quot; or &quot;hmmalign&quot;.</span>
<span class="sd">            Defaults to &quot;papara&quot;.</span>
<span class="sd">        output_directory (Path, optional): path to output directory.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        maximum_placement_distance (float, optional): maximum distance of placed</span>
<span class="sd">            sequences (distance measure below). Defaults to 1.0.</span>
<span class="sd">        distance_measure (str, optional): choose distance measure for placements:</span>
<span class="sd">            &quot;pendant_diameter_ratio&quot;,</span>
<span class="sd">            &quot;pendant_distal_ratio&quot; or &quot;pendant&quot;. Defaults to &quot;pendant_diameter_ratio&quot;.</span>
<span class="sd">        minimum_placement_lwr (float, optional): cutoff value for the LWR of</span>
<span class="sd">            placements. Defaults to 0.8.</span>
<span class="sd">        logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_query</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reference_alignment</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_alignment</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reference_tree</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_tree</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="k">else</span> <span class="n">tree_model</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">tree_clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_clusters</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">tree_cluster_scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_cluster_scores</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_score_threshold</span> <span class="o">=</span> <span class="n">tree_cluster_score_threshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">alignment_method</span> <span class="o">=</span> <span class="n">alignment_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span> <span class="o">=</span> <span class="n">reference_labels</span>
    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;placement_results&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="o">=</span> <span class="n">maximum_placement_distance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distance_measure</span> <span class="o">=</span> <span class="n">distance_measure</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="o">=</span> <span class="n">minimum_placement_lwr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;query_cleaned.faa&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;query_cleaned_id_dict.pickle&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;placements&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;assignments&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">/</span> <span class="s2">&quot;counts&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.jplace&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.jplace&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_lwr_filtered.jplace&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_distance_filtered.jplace&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_jplace</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result_distance_filtered_lwr_filtered.jplace&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_out_placements_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span> <span class="o">/</span> <span class="s2">&quot;epa_result.newick&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_taxtable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span> <span class="o">/</span> <span class="s2">&quot;placed_tax_assignments.tsv&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.QueryLabeller.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run pipeline to annotate query sequences through evolutionary placement.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run pipeline to annotate query sequences through evolutionary placement.&quot;&quot;&quot;</span>
    <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="p">,</span>
        <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span><span class="p">,</span>
        <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">idprefix</span><span class="o">=</span><span class="s2">&quot;query_&quot;</span><span class="p">,</span>
        <span class="n">export_dup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>

    <span class="n">place_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">aln</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_alignment</span><span class="p">,</span>
        <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_tree</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_cleaned_query</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_place_outdir</span><span class="p">,</span>
        <span class="n">aln_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment_method</span><span class="p">,</span>
        <span class="n">tree_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">placesequences</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">place_args</span><span class="p">)</span>

    <span class="n">assign_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">jplace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_jplace</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span><span class="p">,</span>
        <span class="n">query_labels</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span><span class="p">],</span>
        <span class="n">ref_clusters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_clusters</span><span class="p">,</span>
        <span class="n">ref_cluster_scores</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_scores</span><span class="p">,</span>
        <span class="n">outgroup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;placed_tax_&quot;</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_assign_outdir</span><span class="p">,</span>
        <span class="n">max_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_placement_distance</span><span class="p">,</span>
        <span class="n">distance_measure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_measure</span><span class="p">,</span>
        <span class="n">minimum_lwr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_placement_lwr</span><span class="p">,</span>
        <span class="n">duplicated_query_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">labelplacements</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">assign_args</span><span class="p">)</span>

    <span class="n">count_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">taxtable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_taxtable</span><span class="p">,</span>
        <span class="n">taxlevels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">,</span> <span class="s2">&quot;family&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;phylum&quot;</span><span class="p">],</span>
        <span class="n">cluster_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_cluster_score_threshold</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_count_outdir</span><span class="p">,</span>
        <span class="n">outprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">export_right_queries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">countplacements</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">count_args</span><span class="p">)</span>

    <span class="n">relabel_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_placements_tree</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_labels</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_query_labels</span><span class="p">],</span>
        <span class="n">labelprefixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ref_&quot;</span><span class="p">,</span> <span class="s2">&quot;query_&quot;</span><span class="p">],</span>
        <span class="n">taxonomy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">aln</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relabeltree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">relabel_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.pipelines.QueryProcessor" class="doc doc-heading">
        <code>QueryProcessor</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Preprocess query sequences: remove duplicates, translate
and relabel if needed, prefilter sequences by HMM.</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">QueryProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocess query sequences: remove duplicates, translate</span>
<span class="sd">    and relabel if needed, prefilter sequences by HMM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_query</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">hmms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minimum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">maximum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">idprefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;query_&quot;</span><span class="p">,</span>
        <span class="n">relabel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">export_dup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hmmsearch_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess query sequences</span>

<span class="sd">        Args:</span>
<span class="sd">            input_query (Path): path to query sequences</span>
<span class="sd">            hmms (list[Path], optional): list of paths to HMMs to prefilter query sequences. Defaults to None.</span>
<span class="sd">            minimum_sequence_length (int, optional): minimum length for sequences to be kept. Defaults to 30.</span>
<span class="sd">            maximum_sequence_length (int, optional): maximum length for sequences to be kept. Defaults to None.</span>
<span class="sd">            idprefix (str, optional): prefix for sequence IDs. Defaults to &quot;query_&quot;.</span>
<span class="sd">            relabel (bool, optional): relabel sequences to short IDs. Defaults to False.</span>
<span class="sd">            translate (bool, optional): translate DNA sequences to peptide. Defaults to False.</span>
<span class="sd">            export_dup (bool, optional): export duplicated sequences. Defaults to False.</span>
<span class="sd">            output_directory (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">            logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_query</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hmms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">hmm</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="n">hmms</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="n">hmmsearch_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span> <span class="o">=</span> <span class="n">minimum_sequence_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span> <span class="o">=</span> <span class="n">maximum_sequence_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idprefix</span> <span class="o">=</span> <span class="n">idprefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relabel</span> <span class="o">=</span> <span class="n">relabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="n">translate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_dup</span> <span class="o">=</span> <span class="n">export_dup</span>
        <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span>
            <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_filtered</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filtered_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to filtered query.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get output directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to log file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run pipeline to preprocess query sequences&quot;&quot;&quot;</span>
        <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
            <span class="n">translate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
            <span class="n">dna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">export_dup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">export_dup</span><span class="p">,</span>
            <span class="n">relabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel</span><span class="p">,</span>
            <span class="n">idprefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idprefix</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">database_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
                <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
                <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
                <span class="n">hmms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmms</span><span class="p">,</span>
                <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">relabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">nocdhit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">noduplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">relabel_prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">maxsizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">minseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span><span class="p">,</span>
                <span class="n">maxseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span><span class="p">,</span>
                <span class="n">hmmsearch_args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span><span class="p">,</span>
                <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">makedatabase</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">database_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryProcessor.filtered_query" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filtered_query</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to filtered query.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryProcessor.logfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to log file.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.QueryProcessor.output_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get output directory.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.QueryProcessor.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">input_query</span><span class="p">,</span> <span class="n">hmms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimum_sequence_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maximum_sequence_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idprefix</span><span class="o">=</span><span class="s1">&#39;query_&#39;</span><span class="p">,</span> <span class="n">relabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">export_dup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hmmsearch_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Preprocess query sequences</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_query</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query sequences</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hmms</code></td>
          <td>
                <code>list[<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>list of paths to HMMs to prefilter query sequences. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>minimum_sequence_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>minimum length for sequences to be kept. Defaults to 30.</p></td>
          <td>
                <code>30</code>
          </td>
        </tr>
        <tr>
          <td><code>maximum_sequence_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum length for sequences to be kept. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>idprefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix for sequence IDs. Defaults to "query_".</p></td>
          <td>
                <code>&#39;query_&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>relabel</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>relabel sequences to short IDs. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>translate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>translate DNA sequences to peptide. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>export_dup</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>export duplicated sequences. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>output_directory</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>logfile</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to logfile. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_query</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">hmms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minimum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">maximum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">idprefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;query_&quot;</span><span class="p">,</span>
    <span class="n">relabel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">export_dup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hmmsearch_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess query sequences</span>

<span class="sd">    Args:</span>
<span class="sd">        input_query (Path): path to query sequences</span>
<span class="sd">        hmms (list[Path], optional): list of paths to HMMs to prefilter query sequences. Defaults to None.</span>
<span class="sd">        minimum_sequence_length (int, optional): minimum length for sequences to be kept. Defaults to 30.</span>
<span class="sd">        maximum_sequence_length (int, optional): maximum length for sequences to be kept. Defaults to None.</span>
<span class="sd">        idprefix (str, optional): prefix for sequence IDs. Defaults to &quot;query_&quot;.</span>
<span class="sd">        relabel (bool, optional): relabel sequences to short IDs. Defaults to False.</span>
<span class="sd">        translate (bool, optional): translate DNA sequences to peptide. Defaults to False.</span>
<span class="sd">        export_dup (bool, optional): export duplicated sequences. Defaults to False.</span>
<span class="sd">        output_directory (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_query</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hmms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">hmm</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">hmm</span> <span class="ow">in</span> <span class="n">hmms</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="n">hmmsearch_args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span> <span class="o">=</span> <span class="n">minimum_sequence_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span> <span class="o">=</span> <span class="n">maximum_sequence_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">idprefix</span> <span class="o">=</span> <span class="n">idprefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relabel</span> <span class="o">=</span> <span class="n">relabel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="n">translate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">export_dup</span> <span class="o">=</span> <span class="n">export_dup</span>
    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span>
        <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_filtered</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.QueryProcessor.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run pipeline to preprocess query sequences</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run pipeline to preprocess query sequences&quot;&quot;&quot;</span>
    <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_query</span><span class="p">,</span>
        <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
        <span class="n">translate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
        <span class="n">dna</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">export_dup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">export_dup</span><span class="p">,</span>
        <span class="n">relabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel</span><span class="p">,</span>
        <span class="n">idprefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idprefix</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">database_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_filtered_query</span><span class="p">,</span>
            <span class="n">hmms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmms</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">relabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">nocdhit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">noduplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">relabel_prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">maxsizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">minseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span><span class="p">,</span>
            <span class="n">maxseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span><span class="p">,</span>
            <span class="n">hmmsearch_args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">makedatabase</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">database_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.pipelines.ReferenceTreeBuilder" class="doc doc-heading">
        <code>ReferenceTreeBuilder</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Reconstruct reference phylogenetic tree from sequence database and hmms</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReferenceTreeBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reconstruct reference phylogenetic tree from sequence database and hmms</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_database</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">hmms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
        <span class="n">maximum_hmm_reference_sizes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minimum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">maximum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">relabel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">relabel_prefixes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hmmsearch_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tree_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fasttree&quot;</span><span class="p">,</span>
        <span class="n">tree_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;iqtest&quot;</span><span class="p">,</span>
        <span class="n">msa_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;muscle&quot;</span><span class="p">,</span>
        <span class="n">skip_preprocess</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconstruct reference phylogenetic tree from sequence database and hmms</span>

<span class="sd">        Args:</span>
<span class="sd">            input_database (Path): path to input sequence database in FASTA format</span>
<span class="sd">            hmms (list[Path]): list of paths to HMM files</span>
<span class="sd">            max_hmm_reference_size (list[int], optional): list of maximum database size for each HMM. Defaults to None.</span>
<span class="sd">            min_sequence_length (int, optional): minimum length of sequences in final database. Defaults to 10.</span>
<span class="sd">            max_sequence_length (int, optional): maximum length of sequencesin final database. Defaults to 1000.</span>
<span class="sd">            output_directory (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">            translate (bool, optional): whether to translate input (DNA) sequences. Defaults to False.</span>
<span class="sd">            relabel (bool, optional): whether to relabel records in reference database with provisional short labels. Defaults to True.</span>
<span class="sd">            remove_duplicates (bool, optional): whether to remove duplicated sequences in database. Defaults to True.</span>
<span class="sd">            relabel_prefixes (list[str], optional): list of prefixes to be added to each relabelled record. One for</span>
<span class="sd">                each HMM-derived database. Defaults to None.</span>
<span class="sd">            hmmsearch_args (str, optional): additional arguments to hmmsearch as a string. Defaults to None.</span>
<span class="sd">            tree_method (str, optional): choose tree inference method: &quot;iqtree&quot; or &quot;fasttree&quot;. Defaults to &quot;fasttree&quot;.</span>
<span class="sd">            tree_model (str, optional): choose method to select substitution model: &quot;iqtest&quot;, &quot;modeltest&quot;,</span>
<span class="sd">                or a valid substitution model name (compatible with EPA-ng). Defaults to &quot;iqtest&quot;.</span>
<span class="sd">            msa_method (str, optional): choose msa method for reference database: &quot;muscle&quot; or &quot;mafft&quot;.</span>
<span class="sd">                Defaults to &quot;muscle&quot;.</span>
<span class="sd">            skip_preprocess (bool, optional): whether to skip preprocessing step. Defaults to False.</span>
<span class="sd">            logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_database</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="n">hmms</span>
        <span class="k">if</span> <span class="n">maximum_hmm_reference_sizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">hmms</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span> <span class="o">=</span> <span class="n">maximum_hmm_reference_sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span> <span class="o">=</span> <span class="n">minimum_sequence_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span> <span class="o">=</span> <span class="n">maximum_sequence_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="n">translate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relabel</span> <span class="o">=</span> <span class="n">relabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span> <span class="o">=</span> <span class="n">remove_duplicates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relabel_prefixes</span> <span class="o">=</span> <span class="n">relabel_prefixes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hmmsearch_args</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hmmsearch_args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)):</span>
            <span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">hmmsearch_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="n">hmmsearch_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msa_method</span> <span class="o">=</span> <span class="n">msa_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_method</span> <span class="o">=</span> <span class="n">tree_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_database</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_cleaned.faa&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.faa&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.newick&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_alignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.faln&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_reference_labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database_id_dict.pickle&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_tree_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_preprocess</span> <span class="o">=</span> <span class="n">skip_preprocess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get output directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cleaned_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to cleaned database.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to reference database.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_database</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to reference labels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_reference_labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to reference tree.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_tree</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to reference alignment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_alignment</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get path to log file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run pipeline to build reference tree.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_preprocess</span><span class="p">:</span>
            <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_database</span><span class="p">,</span>
                <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="p">,</span>
                <span class="n">translate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
                <span class="n">dna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
                <span class="n">export_dup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">,</span>
                <span class="n">relabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">idprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Please, first run preprocess step by setting &#39;skip_preprocess=False&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="n">database_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">hmms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmms</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">relabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel</span><span class="p">,</span>
            <span class="n">nocdhit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">noduplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">relabel_prefixes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel_prefixes</span><span class="p">,</span>
            <span class="n">maxsizes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span><span class="p">,</span>
            <span class="n">minseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span><span class="p">,</span>
            <span class="n">maxseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span><span class="p">,</span>
            <span class="n">hmmsearch_args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">makedatabase</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">database_args</span><span class="p">)</span>

        <span class="n">tree_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_database</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
            <span class="n">msa_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">msa_method</span><span class="p">,</span>
            <span class="n">tree_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span><span class="p">,</span>
            <span class="n">tree_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_method</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">buildtree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tree_args</span><span class="p">)</span>

        <span class="n">relabel_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_tree</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_reference_labels</span><span class="p">],</span>
            <span class="n">labelprefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">taxonomy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">aln</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">relabeltree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">relabel_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.cleaned_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cleaned_database</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to cleaned database.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.logfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to log file.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.output_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get output directory.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.reference_alignment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reference_alignment</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to reference alignment.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.reference_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reference_database</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to reference database.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.reference_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reference_labels</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to reference labels.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.reference_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reference_tree</span><span class="p">:</span> <span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get path to reference tree.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">input_database</span><span class="p">,</span> <span class="n">hmms</span><span class="p">,</span> <span class="n">maximum_hmm_reference_sizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimum_sequence_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maximum_sequence_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">relabel_prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hmmsearch_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;fasttree&#39;</span><span class="p">,</span> <span class="n">tree_model</span><span class="o">=</span><span class="s1">&#39;iqtest&#39;</span><span class="p">,</span> <span class="n">msa_method</span><span class="o">=</span><span class="s1">&#39;muscle&#39;</span><span class="p">,</span> <span class="n">skip_preprocess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Reconstruct reference phylogenetic tree from sequence database and hmms</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_database</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input sequence database in FASTA format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hmms</code></td>
          <td>
                <code>list[<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>list of paths to HMM files</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_hmm_reference_size</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>list of maximum database size for each HMM. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_sequence_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>minimum length of sequences in final database. Defaults to 10.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_sequence_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum length of sequencesin final database. Defaults to 1000.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_directory</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>translate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to translate input (DNA) sequences. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>relabel</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to relabel records in reference database with provisional short labels. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>remove_duplicates</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to remove duplicated sequences in database. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>relabel_prefixes</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of prefixes to be added to each relabelled record. One for
each HMM-derived database. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hmmsearch_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to hmmsearch as a string. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>tree_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose tree inference method: "iqtree" or "fasttree". Defaults to "fasttree".</p></td>
          <td>
                <code>&#39;fasttree&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>tree_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose method to select substitution model: "iqtest", "modeltest",
or a valid substitution model name (compatible with EPA-ng). Defaults to "iqtest".</p></td>
          <td>
                <code>&#39;iqtest&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>msa_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose msa method for reference database: "muscle" or "mafft".
Defaults to "muscle".</p></td>
          <td>
                <code>&#39;muscle&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>skip_preprocess</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to skip preprocessing step. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>logfile</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to logfile. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_database</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">hmms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">maximum_hmm_reference_sizes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minimum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">maximum_sequence_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_directory</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">translate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">relabel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">relabel_prefixes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hmmsearch_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tree_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fasttree&quot;</span><span class="p">,</span>
    <span class="n">tree_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;iqtest&quot;</span><span class="p">,</span>
    <span class="n">msa_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;muscle&quot;</span><span class="p">,</span>
    <span class="n">skip_preprocess</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">logfile</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct reference phylogenetic tree from sequence database and hmms</span>

<span class="sd">    Args:</span>
<span class="sd">        input_database (Path): path to input sequence database in FASTA format</span>
<span class="sd">        hmms (list[Path]): list of paths to HMM files</span>
<span class="sd">        max_hmm_reference_size (list[int], optional): list of maximum database size for each HMM. Defaults to None.</span>
<span class="sd">        min_sequence_length (int, optional): minimum length of sequences in final database. Defaults to 10.</span>
<span class="sd">        max_sequence_length (int, optional): maximum length of sequencesin final database. Defaults to 1000.</span>
<span class="sd">        output_directory (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        translate (bool, optional): whether to translate input (DNA) sequences. Defaults to False.</span>
<span class="sd">        relabel (bool, optional): whether to relabel records in reference database with provisional short labels. Defaults to True.</span>
<span class="sd">        remove_duplicates (bool, optional): whether to remove duplicated sequences in database. Defaults to True.</span>
<span class="sd">        relabel_prefixes (list[str], optional): list of prefixes to be added to each relabelled record. One for</span>
<span class="sd">            each HMM-derived database. Defaults to None.</span>
<span class="sd">        hmmsearch_args (str, optional): additional arguments to hmmsearch as a string. Defaults to None.</span>
<span class="sd">        tree_method (str, optional): choose tree inference method: &quot;iqtree&quot; or &quot;fasttree&quot;. Defaults to &quot;fasttree&quot;.</span>
<span class="sd">        tree_model (str, optional): choose method to select substitution model: &quot;iqtest&quot;, &quot;modeltest&quot;,</span>
<span class="sd">            or a valid substitution model name (compatible with EPA-ng). Defaults to &quot;iqtest&quot;.</span>
<span class="sd">        msa_method (str, optional): choose msa method for reference database: &quot;muscle&quot; or &quot;mafft&quot;.</span>
<span class="sd">            Defaults to &quot;muscle&quot;.</span>
<span class="sd">        skip_preprocess (bool, optional): whether to skip preprocessing step. Defaults to False.</span>
<span class="sd">        logfile (Path, optional): path to logfile. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_database</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hmms</span> <span class="o">=</span> <span class="n">hmms</span>
    <span class="k">if</span> <span class="n">maximum_hmm_reference_sizes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">hmms</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span> <span class="o">=</span> <span class="n">maximum_hmm_reference_sizes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span> <span class="o">=</span> <span class="n">minimum_sequence_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span> <span class="o">=</span> <span class="n">maximum_sequence_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="n">translate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relabel</span> <span class="o">=</span> <span class="n">relabel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span> <span class="o">=</span> <span class="n">remove_duplicates</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relabel_prefixes</span> <span class="o">=</span> <span class="n">relabel_prefixes</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hmmsearch_args</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hmmsearch_args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)):</span>
        <span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">hmmsearch_args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span> <span class="o">=</span> <span class="n">hmmsearch_args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msa_method</span> <span class="o">=</span> <span class="n">msa_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree_method</span> <span class="o">=</span> <span class="n">tree_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree_model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_database</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_cleaned.faa&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.faa&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.newick&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_alignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database.faln&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">out_reference_labels</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">/</span> <span class="s2">&quot;ref_database_id_dict.pickle&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">out_tree_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skip_preprocess</span> <span class="o">=</span> <span class="n">skip_preprocess</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span> <span class="o">=</span> <span class="n">logfile</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.pipelines.ReferenceTreeBuilder.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run pipeline to build reference tree.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run pipeline to build reference tree.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_preprocess</span><span class="p">:</span>
        <span class="n">preprocess_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_database</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="p">,</span>
            <span class="n">translate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
            <span class="n">dna</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span>
            <span class="n">export_dup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">,</span>
            <span class="n">relabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">idprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">preprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">preprocess_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Please, first run preprocess step by setting &#39;skip_preprocess=False&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="n">database_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_cleaned_database</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
        <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hmms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmms</span><span class="p">,</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">relabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel</span><span class="p">,</span>
        <span class="n">nocdhit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">noduplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">relabel_prefixes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relabel_prefixes</span><span class="p">,</span>
        <span class="n">maxsizes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hmm_reference_sizes</span><span class="p">,</span>
        <span class="n">minseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_sequence_length</span><span class="p">,</span>
        <span class="n">maxseqlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_sequence_length</span><span class="p">,</span>
        <span class="n">hmmsearch_args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hmmsearch_args</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">makedatabase</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">database_args</span><span class="p">)</span>

    <span class="n">tree_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_database</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span><span class="p">,</span>
        <span class="n">msa_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">msa_method</span><span class="p">,</span>
        <span class="n">tree_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_model</span><span class="p">,</span>
        <span class="n">tree_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_method</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">buildtree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tree_args</span><span class="p">)</span>

    <span class="n">relabel_args</span> <span class="o">=</span> <span class="n">CommandArgs</span><span class="p">(</span>
        <span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_reference_tree</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_reference_labels</span><span class="p">],</span>
        <span class="n">labelprefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">taxonomy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">aln</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">taxofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">relabeltree</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">relabel_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="module-databasepreprocessing">Module database.preprocessing</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.database.preprocessing"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to preprocess sequence databases</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.assert_correct_sequence_format" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assert_correct_sequence_format</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_peptide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Filter out (DNA or peptide) sequences containing illegal characters</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fasta_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>is_peptide</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether FASTA contains peptide sequences.
Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assert_correct_sequence_format</span><span class="p">(</span>
    <span class="n">fasta_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_peptide</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter out (DNA or peptide) sequences containing illegal characters</span>

<span class="sd">    Args:</span>
<span class="sd">        fasta_file (Path): path to input FASTA file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        is_peptide (bool, optional): whether FASTA contains peptide sequences.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fasta_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">fasta_file</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">fasta_file</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">fasta_file</span><span class="o">.</span><span class="n">suffix</span>

    <span class="k">def</span> <span class="nf">remove_stop_codon_signals</span><span class="p">(</span><span class="n">record_seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">record_seq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">dirname</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_modified</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_peptide</span><span class="p">:</span>
        <span class="n">is_legit_sequence</span> <span class="o">=</span> <span class="n">is_legit_peptide_sequence</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_legit_sequence</span> <span class="o">=</span> <span class="n">is_legit_dna_sequence</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ffile</span><span class="p">:</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">pyfastx</span><span class="o">.</span><span class="n">Fasta</span><span class="p">(</span><span class="n">ffile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">build_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record_name</span><span class="p">,</span> <span class="n">record_seq</span> <span class="ow">in</span> <span class="n">fasta</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_peptide</span><span class="p">:</span>
                <span class="n">record_seq</span> <span class="o">=</span> <span class="n">remove_stop_codon_signals</span><span class="p">(</span><span class="n">record_seq</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_legit_sequence</span><span class="p">(</span><span class="n">record_seq</span><span class="p">):</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">record_name</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">record_seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.fasta_contains_nucleotide_sequences" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fasta_contains_nucleotide_sequences</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check whether fasta file contains nucleotide sequences</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fasta_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>whehter FASTa contains nucleotide sequences</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fasta_contains_nucleotide_sequences</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether fasta file contains nucleotide sequences</span>

<span class="sd">    Args:</span>
<span class="sd">        fasta_file (Path): path to input FASTA file</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: whehter FASTa contains nucleotide sequences</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ffile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">seq_1</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ffile</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">))</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">seq_1</span><span class="o">.</span><span class="n">seq</span>
    <span class="n">ffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">is_legit_dna_sequence</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.is_fasta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_fasta</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check whether file is of type FASTA</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>answer</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_fasta</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether file is of type FASTA</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (Path): path to input file</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: answer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">fasta</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">fasta</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.is_legit_dna_sequence" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_legit_dna_sequence</span><span class="p">(</span><span class="n">record_seq</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Assert that DNA sequence only contains valid symbols</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>record_seq</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>record squence as a string</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>whether sequence corresponds to DNA</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_legit_dna_sequence</span><span class="p">(</span><span class="n">record_seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assert that DNA sequence only contains valid symbols</span>

<span class="sd">    Args:</span>
<span class="sd">        record_seq (str): record squence as a string</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: whether sequence corresponds to DNA</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">}</span>
    <span class="n">seq_symbols</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">record_seq</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">seq_symbols</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">nts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.is_legit_peptide_sequence" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_legit_peptide_sequence</span><span class="p">(</span><span class="n">record_seq</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Assert that peptide sequence only contains valid symbols</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>record_seq</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>record sequence as a string</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>whether sequence correpsonds to a peptide</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_legit_peptide_sequence</span><span class="p">(</span><span class="n">record_seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assert that peptide sequence only contains valid symbols</span>

<span class="sd">    Args:</span>
<span class="sd">        record_seq (str): record sequence as a string</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: whether sequence correpsonds to a peptide</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aas</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;D&quot;</span><span class="p">,</span>
        <span class="s2">&quot;E&quot;</span><span class="p">,</span>
        <span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="s2">&quot;G&quot;</span><span class="p">,</span>
        <span class="s2">&quot;H&quot;</span><span class="p">,</span>
        <span class="s2">&quot;I&quot;</span><span class="p">,</span>
        <span class="s2">&quot;K&quot;</span><span class="p">,</span>
        <span class="s2">&quot;L&quot;</span><span class="p">,</span>
        <span class="s2">&quot;M&quot;</span><span class="p">,</span>
        <span class="s2">&quot;N&quot;</span><span class="p">,</span>
        <span class="s2">&quot;P&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Q&quot;</span><span class="p">,</span>
        <span class="s2">&quot;R&quot;</span><span class="p">,</span>
        <span class="s2">&quot;S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="s2">&quot;V&quot;</span><span class="p">,</span>
        <span class="s2">&quot;W&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">seq_symbols</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">record_seq</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">seq_symbols</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">aas</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.merge_fastas" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_fastas</span><span class="p">(</span><span class="n">input_fastas_dir</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Merge input fasta files into a single fasta</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fastas_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge_fastas</span><span class="p">(</span><span class="n">input_fastas_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge input fasta files into a single fasta</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fastas_dir (Path): path to input FASTA file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fastas_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fastas_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">input_fastas_dir</span> <span class="o">/</span> <span class="s2">&quot;merged.fasta&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;printf &#39;%s</span><span class="se">\\</span><span class="s2">0&#39; * | xargs -0 cat &gt; </span><span class="si">{</span><span class="n">output_fasta</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">input_fastas_dir</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.remove_duplicates_from_fasta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_duplicates_from_fasta</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Removes duplicate entries (either by sequence or ID) from fasta.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>export_duplicates</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to export a file cotnainig
duplicated sequences. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>duplicates_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to duplicates output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_duplicates_from_fasta</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">export_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">duplicates_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes duplicate entries (either by sequence or ID) from fasta.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        export_duplicates (bool, optional): whether to export a file cotnainig</span>
<span class="sd">            duplicated sequences. Defaults to False.</span>
<span class="sd">        duplicates_file (Path, optional): path to duplicates output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;_noduplicates&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">duplicates_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">duplicates_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;_duplicates&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span>
        <span class="p">)</span>
    <span class="n">wrappers</span><span class="o">.</span><span class="n">run_seqkit_nodup</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
        <span class="n">output_fasta</span><span class="o">=</span><span class="n">output_fasta</span><span class="p">,</span>
        <span class="n">export_duplicates</span><span class="o">=</span><span class="n">export_duplicates</span><span class="p">,</span>
        <span class="n">duplicates_file</span><span class="o">=</span><span class="n">duplicates_file</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.set_original_record_ids_in_fasta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_original_record_ids_in_fasta</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">label_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Relabel temporary record ID by original IDs</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>label_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary containing labels to short IDs
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_original_record_ids_in_fasta</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relabel temporary record ID by original IDs</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        label_dict (dict, optional): dictionary containing labels to short IDs</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_original_ids&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">relabel_records</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">label_dict</span><span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">record</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">record</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">yield</span> <span class="n">record</span>

    <span class="n">SeqIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">relabel_records</span><span class="p">(),</span> <span class="n">output_fasta</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.set_temp_record_ids_in_fasta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_temp_record_ids_in_fasta</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Change record ids for numbers and store then in a dictionary</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to record names in output FASTA.
 Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dict</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_temp_record_ids_in_fasta</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dict</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change record ids for numbers and store then in a dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        prefix (str, optional): prefix to record names in output FASTA.</span>
<span class="sd">             Defaults to None.</span>
<span class="sd">        output_fasta (Path, optional): _description_. Defaults to None.</span>
<span class="sd">        output_dict (Path, optional): _description_. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">input_fasta</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix_str</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">fasta_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_short_ids&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">dict_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_id_dict&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.pickle&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">fasta_file</span>
    <span class="k">if</span> <span class="n">output_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dict</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">dict_file</span>

    <span class="n">id_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfasta</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">ffile</span><span class="p">:</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">pyfastx</span><span class="o">.</span><span class="n">Fasta</span><span class="p">(</span><span class="n">ffile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">build_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">record_name</span><span class="p">,</span> <span class="n">record_seq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fasta</span><span class="p">):</span>
            <span class="n">new_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_str</span><span class="si">}{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">id_dict</span><span class="p">[</span><span class="n">new_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">record_name</span>
            <span class="n">outfasta</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">new_id</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">record_seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">save_to_pickle_file</span><span class="p">(</span><span class="n">id_dict</span><span class="p">,</span> <span class="n">output_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.preprocessing.write_record_names_to_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_record_names_to_file</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">filter_by_tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Write a txt file containing a list of record IDs in fasta</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filter_by_tag</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>set to str containing a pattern to match
in record labels. In this case, only matched record labels
are returned. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/preprocessing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_record_names_to_file</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">filter_by_tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a txt file containing a list of record IDs in fasta</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        filter_by_tag (str, optional): set to str containing a pattern to match</span>
<span class="sd">            in record labels. In this case, only matched record labels</span>
<span class="sd">            are returned. Defaults to None.</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filter_by_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">filter_by_tag</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grep &#39;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> | cut -c 2- &gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-databasemanipulation">Module database.manipulation</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.database.manipulation"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to create peptide-specific sequence databases</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.convert_fasta_aln_to_phylip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_fasta_aln_to_phylip</span><span class="p">(</span><span class="n">input_fasta_aln</span><span class="p">,</span> <span class="n">output_phylip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert alignments in Fasta to Phylip.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_phylip</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_fasta_aln_to_phylip</span><span class="p">(</span>
    <span class="n">input_fasta_aln</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_phylip</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert alignments in Fasta to Phylip.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta_aln (Path): path to input alignment file</span>
<span class="sd">        output_phylip (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta_aln</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta_aln</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_phylip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_phylip</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta_aln</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.phylip&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_phylip</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_phylip</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_fasta_aln</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_handle</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>
        <span class="n">output_phylip</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">output_handle</span><span class="p">:</span>
        <span class="n">alignments</span> <span class="o">=</span> <span class="n">AlignIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_handle</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
        <span class="n">AlignIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">alignments</span><span class="p">,</span> <span class="n">output_handle</span><span class="p">,</span> <span class="s2">&quot;phylip-relaxed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.convert_phylip_to_fasta_aln" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_phylip_to_fasta_aln</span><span class="p">(</span><span class="n">input_phylip</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert alignments in Phylip to Fasta format</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_phylip</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_phylip_to_fasta_aln</span><span class="p">(</span><span class="n">input_phylip</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert alignments in Phylip to Fasta format</span>

<span class="sd">    Args:</span>
<span class="sd">        input_phylip (Path): path to input alignment file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_phylip</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_phylip</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_phylip</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">alignments</span> <span class="o">=</span> <span class="n">AlignIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_phylip</span><span class="p">,</span> <span class="s2">&quot;phylip-relaxed&quot;</span><span class="p">)</span>
    <span class="n">AlignIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">alignments</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.convert_stockholm_to_fasta_aln" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_stockholm_to_fasta_aln</span><span class="p">(</span><span class="n">input_stockholm</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert alignment file in Stockholm format to fasta</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_stockholm</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_stockholm_to_fasta_aln</span><span class="p">(</span>
    <span class="n">input_stockholm</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert alignment file in Stockholm format to fasta</span>

<span class="sd">    Args:</span>
<span class="sd">        input_stockholm (Path): path to input alignment file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_stockholm</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_stockholm</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_stockholm</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">alignments</span> <span class="o">=</span> <span class="n">AlignIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">input_stockholm</span><span class="p">,</span> <span class="s2">&quot;stockholm&quot;</span><span class="p">)</span>
    <span class="n">AlignIO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">alignments</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">,</span> <span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.filter_fasta_by_hmm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_fasta_by_hmm</span><span class="p">(</span><span class="n">hmm_model</span><span class="p">,</span> <span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hmmer_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hmmsearch&#39;</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate protein-specific database by filtering
   sequence database to only contain sequences
   corresponing to protein of interest</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hmm_model</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to hmm model</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>hmmer_output</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to hmmer output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose hmmer method: "hmmsearch" or "hmmscan". Defaults to "hmmsearch".</p></td>
          <td>
                <code>&#39;hmmsearch&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to hmmsearch/scan as a string. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_fasta_by_hmm</span><span class="p">(</span>
    <span class="n">hmm_model</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hmmer_output</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hmmsearch&quot;</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate protein-specific database by filtering</span>
<span class="sd">       sequence database to only contain sequences</span>
<span class="sd">       corresponing to protein of interest</span>

<span class="sd">    Args:</span>
<span class="sd">        hmm_model (Path): path to hmm model</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        hmmer_output (Path, optional): path to hmmer output directory. Defaults to None.</span>
<span class="sd">        method (str, optional): choose hmmer method: &quot;hmmsearch&quot; or &quot;hmmscan&quot;. Defaults to &quot;hmmsearch&quot;.</span>
<span class="sd">        additional_args (str, optional): additional arguments to hmmsearch/scan as a string. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hmm_model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">hmm_model</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hmmer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hmmer_output</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">hmm_model</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hmmer_output</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">hmmer_output</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;filtered_</span><span class="si">{</span><span class="n">hmm_model</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running Hmmer...&quot;</span><span class="p">)</span>
    <span class="n">wrappers</span><span class="o">.</span><span class="n">run_hmmsearch</span><span class="p">(</span>
        <span class="n">hmm_model</span><span class="o">=</span><span class="n">hmm_model</span><span class="p">,</span>
        <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">hmmer_output</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parsing Hmmer output file...&quot;</span><span class="p">)</span>
    <span class="n">hmmer_hits</span> <span class="o">=</span> <span class="n">parse_hmmsearch_output</span><span class="p">(</span><span class="n">hmmer_output</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hmmer_hits</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hmmer_hits</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No records found in database matching provided hmm&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filtering Fasta...&quot;</span><span class="p">)</span>
    <span class="n">filter_fasta_by_ids</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="p">,</span> <span class="n">record_ids</span><span class="o">=</span><span class="n">hmmer_hits</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="n">output_fasta</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.filter_fasta_by_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_fasta_by_ids</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">record_ids</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Filter records in fasta file matching provided IDs</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>record_ids</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of record IDs to filter FASTA file by</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_fasta_by_ids</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">record_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter records in fasta file matching provided IDs</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        record_ids (list): list of record IDs to filter FASTA file by</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;_fitered&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">index_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.fxi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">index_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">record_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">record_ids</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+t&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_ids</span><span class="p">:</span>
        <span class="n">tmp_ids</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record_ids</span><span class="p">))</span>
        <span class="n">tmp_ids</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">tmp_ids_path</span> <span class="o">=</span> <span class="n">tmp_ids</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seqkit grep -i -f </span><span class="si">{</span><span class="n">tmp_ids_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">output_fasta</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.filter_fasta_by_sequence_length" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_fasta_by_sequence_length</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Filter sequences by length in fasta file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_fasta_by_sequence_length</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter sequences by length in fasta file</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file</span>
<span class="sd">        min_length (int, optional): _description_. Defaults to None.</span>
<span class="sd">        max_length (int, optional): _description_. Defaults to None.</span>
<span class="sd">        output_fasta (Path, optional): _description_. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">min_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Missing boundary values for sequence length&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ffile</span><span class="p">:</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">pyfastx</span><span class="o">.</span><span class="n">Fasta</span><span class="p">(</span><span class="n">ffile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">record_ids</span> <span class="o">=</span> <span class="n">fasta</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">min_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">max_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_length</span><span class="p">)</span>
            <span class="n">record_ids</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">record_ids</span> <span class="o">&gt;=</span> <span class="n">min_length</span><span class="p">,</span> <span class="n">record_ids</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">record_ids</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">record_ids</span> <span class="o">&gt;=</span> <span class="n">min_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="n">input_fasta</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_length_</span><span class="si">{</span><span class="n">min_length</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">max_tag</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record_ids</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No records found with given sequence length bounds&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">record_id</span> <span class="ow">in</span> <span class="n">record_ids</span><span class="p">:</span>
                <span class="n">record_obj</span> <span class="o">=</span> <span class="n">fasta</span><span class="p">[</span><span class="n">record_id</span><span class="p">]</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">record_obj</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.fxi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.get_fasta_record_ids" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_fasta_record_ids</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extract record ids from fasta</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fasta_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>set</code></td>          <td>
                <code>set</code>
          </td>
          <td><p>set of record IDs in FAStA file</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fasta_record_ids</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract record ids from fasta</span>

<span class="sd">    Args:</span>
<span class="sd">        fasta_file (Path): path to input FASTA file</span>

<span class="sd">    Returns:</span>
<span class="sd">        set: set of record IDs in FAStA file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fasta_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fasta_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ffile</span><span class="p">:</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">pyfastx</span><span class="o">.</span><span class="n">Fasta</span><span class="p">(</span><span class="n">ffile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fasta_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fasta</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">fasta_keys</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.parse_hmmsearch_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_hmmsearch_output</span><span class="p">(</span><span class="n">hmmer_output</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse hmmsearch or hmmscan summary table output file</p>
<p>Args
    hmmer_output (Path): path to hmmsearch or hmmscan summary table output file</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_hmmsearch_output</span><span class="p">(</span><span class="n">hmmer_output</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse hmmsearch or hmmscan summary table output file</span>

<span class="sd">    Args</span>
<span class="sd">        hmmer_output (Path): path to hmmsearch or hmmscan summary table output file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attribs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;bias&quot;</span><span class="p">,</span> <span class="s2">&quot;bitscore&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">]</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hmmer_output</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">queryresult</span> <span class="ow">in</span> <span class="n">SearchIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;hmmer3-tab&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">queryresult</span><span class="o">.</span><span class="n">hits</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                    <span class="n">hits</span><span class="p">[</span><span class="n">attrib</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">attrib</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.manipulation.split_reference_from_query_alignments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">split_reference_from_query_alignments</span><span class="p">(</span><span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">ref_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Separate reference sequences from query sequences in msa fasta file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ref_query_msa</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input papara/hmmalign alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_ids</code></td>
          <td>
                <code>set</code>
          </td>
          <td><p>IDs of reference sequences. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix employed by all reference sequences
(Use instead of ref_ids). Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/manipulation.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_reference_from_query_alignments</span><span class="p">(</span>
    <span class="n">ref_query_msa</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">ref_ids</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ref_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Separate reference sequences from query sequences in msa fasta file</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_query_msa (Path): path to input papara/hmmalign alignment file</span>
<span class="sd">        ref_ids (set, optional): IDs of reference sequences. Defaults to None.</span>
<span class="sd">        ref_prefix (str, optional): prefix employed by all reference sequences</span>
<span class="sd">            (Use instead of ref_ids). Defaults to None.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_query_msa</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ref_query_msa</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">ref_query_msa</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ref_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ref_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">is_reference</span><span class="p">(</span><span class="n">record_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">record_name</span> <span class="ow">in</span> <span class="n">ref_ids</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">ref_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ref_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">is_reference</span><span class="p">(</span><span class="n">record_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">record_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ref_prefix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Provide either set of ref ids or ref prefix&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">out_ref_msa</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_ref_fraction&quot;</span><span class="p">)</span>
    <span class="n">out_query_msa</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_query_fraction&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_ref_msa</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outref</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_query_msa</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outquery</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>
        <span class="n">ref_query_msa</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">msa</span><span class="p">:</span>
        <span class="n">fasta</span> <span class="o">=</span> <span class="n">pyfastx</span><span class="o">.</span><span class="n">Fasta</span><span class="p">(</span><span class="n">msa</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">build_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record_name</span><span class="p">,</span> <span class="n">record_seq</span> <span class="ow">in</span> <span class="n">fasta</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_reference</span><span class="p">(</span><span class="n">record_name</span><span class="p">):</span>
                <span class="n">outref</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">record_name</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">record_seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outquery</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;</span><span class="si">{</span><span class="n">record_name</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">record_seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-databasereduction">Module database.reduction</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.database.reduction"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to reduce the size of the peptide-specific
reference database</p>
<p>Currently based on:
1. CD-HIT
2. Repset: https://onlinelibrary.wiley.com/doi/10.1002/prot.25461</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.reduction.get_representative_set" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_representative_set</span><span class="p">(</span><span class="n">input_seqs</span><span class="p">,</span> <span class="n">input_pi</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Runs repset.py to obtain a representative
   set of size equal to max_size (or smaller if less sequences than max_size)
   or an ordered list (by 'representativeness') of representative sequences
   if max_size set to None.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_seqs</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file containing sequences</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_pi</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input file containing pairwise identity</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>max_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of sequences in reduced database.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/reduction.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_representative_set</span><span class="p">(</span>
    <span class="n">input_seqs</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">input_pi</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs repset.py to obtain a representative</span>
<span class="sd">       set of size equal to max_size (or smaller if less sequences than max_size)</span>
<span class="sd">       or an ordered list (by &#39;representativeness&#39;) of representative sequences</span>
<span class="sd">       if max_size set to None.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_seqs (Path): path to input FASTA file containing sequences</span>
<span class="sd">        input_pi (Path): path to input file containing pairwise identity</span>
<span class="sd">        max_size (int, optional): maximum number of sequences in reduced database.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_seqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_seqs</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_pi</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_pi</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">repset_exe</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;vendor&quot;</span> <span class="o">/</span> <span class="s2">&quot;repset_min.py&quot;</span>

    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_seqs</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_repset&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">TemporaryDirectoryPath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
        <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;python </span><span class="si">{</span><span class="n">repset_exe</span><span class="si">}</span><span class="s2"> --seqs </span><span class="si">{</span><span class="n">input_seqs</span><span class="si">}</span><span class="s2"> --pi </span><span class="si">{</span><span class="n">input_pi</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;--outdir </span><span class="si">{</span><span class="n">tempdir</span><span class="si">}</span><span class="s2"> --size </span><span class="si">{</span><span class="n">max_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;repset.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">repset</span><span class="p">:</span>
            <span class="n">rep_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">rep_id</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">rep_id</span> <span class="ow">in</span> <span class="n">repset</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">max_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_size</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rep_ids</span><span class="p">)):</span>
        <span class="n">rep_ids</span> <span class="o">=</span> <span class="n">rep_ids</span><span class="p">[:</span><span class="n">max_size</span><span class="p">]</span>

    <span class="n">filter_fasta_by_ids</span><span class="p">(</span>
        <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_seqs</span><span class="p">,</span> <span class="n">record_ids</span><span class="o">=</span><span class="n">rep_ids</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="n">output_file</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.database.reduction.reduce_database_redundancy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_database_redundancy</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cdhit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cdhit_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reduce redundancy of peptide datatabase.
   Runs cd-hit, if selected, additional arguments to cdhit
   may be passed as a string (cdhit_args).
   Runs repset to obtain a final database size no larger
   (number of sequences) than selected maxsize.
   If maxsize = None, repset is not run.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input FASTA file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output, reduced fasta.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cdhit</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to use CD-HIT alongside repset. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>maxsize</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of sequences in final database. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cdhit_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to CD-HIT. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/reduction.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_database_redundancy</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cdhit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">maxsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cdhit_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce redundancy of peptide datatabase.</span>
<span class="sd">       Runs cd-hit, if selected, additional arguments to cdhit</span>
<span class="sd">       may be passed as a string (cdhit_args).</span>
<span class="sd">       Runs repset to obtain a final database size no larger</span>
<span class="sd">       (number of sequences) than selected maxsize.</span>
<span class="sd">       If maxsize = None, repset is not run.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input FASTA file.</span>
<span class="sd">        output_fasta (Path, optional): path to output, reduced fasta.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        cdhit (bool, optional): whether to use CD-HIT alongside repset. Defaults to True.</span>
<span class="sd">        maxsize (int, optional): maximum number of sequences in final database. Defaults to None.</span>
<span class="sd">        cdhit_args (str, optional): additional arguments to CD-HIT. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_reduced&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">cdhit</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maxsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No reduction algorithm has been selected.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempaln</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempfasta</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempfasta2</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempident</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cdhit</span><span class="p">:</span>
            <span class="n">wrappers</span><span class="o">.</span><span class="n">run_cdhit</span><span class="p">(</span>
                <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
                <span class="n">output_fasta</span><span class="o">=</span><span class="n">tempfasta</span><span class="p">,</span>
                <span class="n">additional_args</span><span class="o">=</span><span class="n">cdhit_args</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">tempfasta</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.clstr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">tempfasta</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">maxsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wrappers</span><span class="o">.</span><span class="n">run_mafft</span><span class="p">(</span>
                <span class="n">input_fasta</span><span class="o">=</span><span class="n">tempfasta</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="n">tempaln</span><span class="p">,</span>
                <span class="n">processes</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">additional_args</span><span class="o">=</span><span class="s2">&quot;--retree 1 --maxiterate 0 --quiet&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">wrappers</span><span class="o">.</span><span class="n">get_percent_identity_from_msa</span><span class="p">(</span>
                <span class="n">input_msa</span><span class="o">=</span><span class="n">tempaln</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">tempident</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding representative sequences for reference database...&quot;</span><span class="p">)</span>
            <span class="n">get_representative_set</span><span class="p">(</span>
                <span class="n">input_seqs</span><span class="o">=</span><span class="n">tempfasta</span><span class="p">,</span>
                <span class="n">input_pi</span><span class="o">=</span><span class="n">tempident</span><span class="p">,</span>
                <span class="n">max_size</span><span class="o">=</span><span class="n">maxsize</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="n">tempfasta2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempfasta2</span><span class="p">,</span> <span class="n">tempfasta</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempfasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-databaselabelparsers">Module database.labelparsers</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.database.labelparsers"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to parse sequence labels from different databases</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.metatag.database.labelparsers.LabelParser" class="doc doc-heading">
        <code>LabelParser</code>


</h2>


  <div class="doc doc-contents ">



        <details class="quote">
          <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LabelParser</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse labels to extract genome ID and metadata</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str): label to be parsed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">extract_genome_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract genome ID from sequence label</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Genome ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mmp_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_mmp_id</span><span class="p">()</span>
        <span class="n">taxid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_taxid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mmp_id</span> <span class="ow">and</span> <span class="n">taxid</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Label contains conflicting genome IDs&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">mmp_id</span><span class="p">:</span>
            <span class="n">genome_id</span> <span class="o">=</span> <span class="n">mmp_id</span>
        <span class="k">elif</span> <span class="n">taxid</span><span class="p">:</span>
            <span class="n">genome_id</span> <span class="o">=</span> <span class="n">taxid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">genome_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_oceanmicrobiome_id</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">genome_id</span>

    <span class="k">def</span> <span class="nf">extract_mmp_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract MMP ID from sequence label</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: MMP ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db_entry</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;_MMP\d+&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">db_entry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">extract_taxid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract NCBI taxon ID from sequence label</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: NCBI taxon ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db_entry</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(OX=)(\d+)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;taxid_</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">db_entry</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">extract_oceanmicrobiome_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract OceanMicrobiome ID from sequence label</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: OceanMicrobiome ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.database.labelparsers.LabelParser.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Parse labels to extract genome ID and metadata</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>label to be parsed</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse labels to extract genome ID and metadata</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): label to be parsed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.database.labelparsers.LabelParser.extract_genome_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_genome_id</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract genome ID from sequence label</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>Genome ID</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_genome_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genome ID from sequence label</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Genome ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mmp_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_mmp_id</span><span class="p">()</span>
    <span class="n">taxid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_taxid</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mmp_id</span> <span class="ow">and</span> <span class="n">taxid</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Label contains conflicting genome IDs&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">mmp_id</span><span class="p">:</span>
        <span class="n">genome_id</span> <span class="o">=</span> <span class="n">mmp_id</span>
    <span class="k">elif</span> <span class="n">taxid</span><span class="p">:</span>
        <span class="n">genome_id</span> <span class="o">=</span> <span class="n">taxid</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">genome_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_oceanmicrobiome_id</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">genome_id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.database.labelparsers.LabelParser.extract_mmp_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_mmp_id</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract MMP ID from sequence label</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>MMP ID</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_mmp_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract MMP ID from sequence label</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: MMP ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_entry</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;_MMP\d+&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">db_entry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.database.labelparsers.LabelParser.extract_oceanmicrobiome_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_oceanmicrobiome_id</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract OceanMicrobiome ID from sequence label</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>OceanMicrobiome ID</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_oceanmicrobiome_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract OceanMicrobiome ID from sequence label</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: OceanMicrobiome ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.database.labelparsers.LabelParser.extract_taxid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_taxid</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract NCBI taxon ID from sequence label</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>NCBI taxon ID</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/database/labelparsers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_taxid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract NCBI taxon ID from sequence label</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: NCBI taxon ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_entry</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(OX=)(\d+)&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;taxid_</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">db_entry</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="module-alignment">Module alignment</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.alignment"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to perform multiple sequence alignments</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.alignment.align_peptides" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_peptides</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;muscle&#39;</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Perform MSA on reference peptide sequences.
   Outputs in format fasta.aln</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to fasta file containing reference sequences</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Choose alignment method: "muscle" or "mafft". Defaults to "muscle".</p></td>
          <td>
                <code>&#39;muscle&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output alignment file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to aligner. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/alignment.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_peptides</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;muscle&quot;</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform MSA on reference peptide sequences.</span>
<span class="sd">       Outputs in format fasta.aln</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to fasta file containing reference sequences</span>
<span class="sd">        method (str, optional): Choose alignment method: &quot;muscle&quot; or &quot;mafft&quot;. Defaults to &quot;muscle&quot;.</span>
<span class="sd">        output_file (Path, optional): path to output alignment file. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to aligner. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.fasta.aln&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;muscle&quot;</span><span class="p">:</span>
        <span class="n">wrappers</span><span class="o">.</span><span class="n">run_muscle</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
            <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;mafft&quot;</span><span class="p">:</span>
        <span class="n">wrappers</span><span class="o">.</span><span class="n">run_mafft</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="o">=</span><span class="n">input_fasta</span><span class="p">,</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
            <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid method. Valid methods: muscle or mafft&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.alignment.align_short_reads_to_reference_msa" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_short_reads_to_reference_msa</span><span class="p">(</span><span class="n">ref_msa</span><span class="p">,</span> <span class="n">query_seqs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;papara&#39;</span><span class="p">,</span> <span class="n">tree_nwk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Align short read query sequences to reference MSA (fasta format).
   Outputs fasta msa alignment between query and reference sequences</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ref_msa</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference MSA in fasta format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_seqs</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query sequences in fasta format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose aligner: "hmmalign" or "papara". Defaults to "papara".</p></td>
          <td>
                <code>&#39;papara&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>tree_nwk</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference tree in newick format. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/alignment.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_short_reads_to_reference_msa</span><span class="p">(</span>
    <span class="n">ref_msa</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">query_seqs</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;papara&quot;</span><span class="p">,</span>
    <span class="n">tree_nwk</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Align short read query sequences to reference MSA (fasta format).</span>
<span class="sd">       Outputs fasta msa alignment between query and reference sequences</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_msa (Path): path to reference MSA in fasta format</span>
<span class="sd">        query_seqs (Path): path to query sequences in fasta format</span>
<span class="sd">        method (str, optional): choose aligner: &quot;hmmalign&quot; or &quot;papara&quot;. Defaults to &quot;papara&quot;.</span>
<span class="sd">        tree_nwk (Path, optional): path to reference tree in newick format. Defaults to None.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_msa</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ref_msa</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">query_seqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">query_seqs</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">tree_nwk</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_nwk</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">ref_msa</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">output_hmm</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">ref_msa</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.hmm&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">output_aln_seqs</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">query_seqs</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;hmmalign&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_file_path</span><span class="p">:</span>
            <span class="n">wrappers</span><span class="o">.</span><span class="n">run_hmmbuild</span><span class="p">(</span><span class="n">input_aln</span><span class="o">=</span><span class="n">ref_msa</span><span class="p">,</span> <span class="n">output_hmm</span><span class="o">=</span><span class="n">output_hmm</span><span class="p">)</span>

            <span class="n">wrappers</span><span class="o">.</span><span class="n">run_hmmalign</span><span class="p">(</span>
                <span class="n">input_aln</span><span class="o">=</span><span class="n">ref_msa</span><span class="p">,</span>
                <span class="n">input_hmm</span><span class="o">=</span><span class="n">output_hmm</span><span class="p">,</span>
                <span class="n">input_seqs</span><span class="o">=</span><span class="n">query_seqs</span><span class="p">,</span>
                <span class="n">output_aln_seqs</span><span class="o">=</span><span class="n">temp_file_path</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">convert_stockholm_to_fasta_aln</span><span class="p">(</span>
                <span class="n">input_stockholm</span><span class="o">=</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="n">output_aln_seqs</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;papara&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_phy_path</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_aln_path</span><span class="p">:</span>
            <span class="n">convert_fasta_aln_to_phylip</span><span class="p">(</span>
                <span class="n">input_fasta_aln</span><span class="o">=</span><span class="n">ref_msa</span><span class="p">,</span> <span class="n">output_phylip</span><span class="o">=</span><span class="n">temp_phy_path</span>
            <span class="p">)</span>
            <span class="n">wrappers</span><span class="o">.</span><span class="n">run_papara</span><span class="p">(</span>
                <span class="n">tree_nwk</span><span class="o">=</span><span class="n">tree_nwk</span><span class="p">,</span>
                <span class="n">msa_phy</span><span class="o">=</span><span class="n">temp_phy_path</span><span class="p">,</span>
                <span class="n">query_fasta</span><span class="o">=</span><span class="n">query_seqs</span><span class="p">,</span>
                <span class="n">output_aln</span><span class="o">=</span><span class="n">temp_aln_path</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">convert_phylip_to_fasta_aln</span><span class="p">(</span>
                <span class="n">input_phylip</span><span class="o">=</span><span class="n">temp_aln_path</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_aln_seqs</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Alignment method not implemented&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-phylotree">Module phylotree</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.phylotree"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to perform phylogenetic tree reconstructions and
query sequence placements onto trees</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.phylotree.get_iq_tree_model_from_log_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_iq_tree_model_from_log_file</span><span class="p">(</span><span class="n">iqtree_log</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse iqtree log file and return best fit model</p>
<p>If model supplied, search model in Command: iqtree ... -m 'model'
If not, then -m TEST or -m MFP
If one of those, continue to line:
Best-fit model: 'model' chosen according to BIC</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>iqtree_log</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to iqtree log file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>best substitution model employed by iqtree</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/phylotree.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_iq_tree_model_from_log_file</span><span class="p">(</span><span class="n">iqtree_log</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse iqtree log file and return best fit model</span>

<span class="sd">    If model supplied, search model in Command: iqtree ... -m &#39;model&#39;</span>
<span class="sd">    If not, then -m TEST or -m MFP</span>
<span class="sd">    If one of those, continue to line:</span>
<span class="sd">    Best-fit model: &#39;model&#39; chosen according to BIC</span>

<span class="sd">    Args:</span>
<span class="sd">        iqtree_log (Path): path to iqtree log file</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: best substitution model employed by iqtree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">iqtree_log</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">subtext</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;(?&lt;=Command: iqtree)(.*)(?=</span><span class="se">\\</span><span class="s2">n)&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;(?&lt;=-m )(.*)(?= -bb)&quot;</span><span class="p">,</span> <span class="n">subtext</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mfp&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;(?&lt;=Best-fit model: )(.*)(?= chosen)&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.phylotree.get_tree_model_from_modeltest_log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_tree_model_from_modeltest_log</span><span class="p">(</span><span class="n">modeltest_log</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;BIC&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse modeltest-ng log file and return best fit model
according to selected criterion: BIC, AIC or AICc</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>modeltest_log</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to modeltest-ng log file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>criterion</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose best model criterior. Defaults to "BIC".</p></td>
          <td>
                <code>&#39;BIC&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>best substitution model employed by modeltest-ng</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/phylotree.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tree_model_from_modeltest_log</span><span class="p">(</span>
    <span class="n">modeltest_log</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">criterion</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIC&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse modeltest-ng log file and return best fit model</span>
<span class="sd">    according to selected criterion: BIC, AIC or AICc</span>

<span class="sd">    Args:</span>
<span class="sd">        modeltest_log (Path): path to modeltest-ng log file</span>
<span class="sd">        criterion (str, optional): choose best model criterior. Defaults to &quot;BIC&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: best substitution model employed by modeltest-ng</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">modeltest_log</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">easy_pattern_matching</span><span class="p">(</span>
            <span class="n">easy_pattern_matching</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Best model according to </span><span class="si">{</span><span class="n">criterion</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lnL&quot;</span>
            <span class="p">),</span>
            <span class="n">left_pattern</span><span class="o">=</span><span class="s2">&quot;Model:&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.phylotree.infer_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">infer_tree</span><span class="p">(</span><span class="n">ref_aln</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iqtree&#39;</span><span class="p">,</span> <span class="n">substitution_model</span><span class="o">=</span><span class="s1">&#39;modeltest&#39;</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Infer tree from reference msa. Best substitution model
   selected by default.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ref_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference alignment in FASTA format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose tree inference method: "iqtree" or "fasttree". Defaults to "iqtree".</p></td>
          <td>
                <code>&#39;iqtree&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>substitution_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>substitution model employed to infer tree or path to iqtree log
file containing model. The name of an algorithm to choose best substitution model can also be provided.
In that case, choose between "iqtest" or "modeltest". Defaults to "modeltest".</p></td>
          <td>
                <code>&#39;modeltest&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to tree algorithm as a string. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/phylotree.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">infer_tree</span><span class="p">(</span>
    <span class="n">ref_aln</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;iqtree&quot;</span><span class="p">,</span>
    <span class="n">substitution_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;modeltest&quot;</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Infer tree from reference msa. Best substitution model</span>
<span class="sd">       selected by default.</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_aln (Path): path to reference alignment in FASTA format</span>
<span class="sd">        output_dir (Path): path to output directory</span>
<span class="sd">        method (str, optional): choose tree inference method: &quot;iqtree&quot; or &quot;fasttree&quot;. Defaults to &quot;iqtree&quot;.</span>
<span class="sd">        substitution_model (str, optional): substitution model employed to infer tree or path to iqtree log</span>
<span class="sd">            file containing model. The name of an algorithm to choose best substitution model can also be provided.</span>
<span class="sd">            In that case, choose between &quot;iqtest&quot; or &quot;modeltest&quot;. Defaults to &quot;modeltest&quot;.</span>
<span class="sd">        additional_args (str, optional): additional arguments to tree algorithm as a string. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_aln</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ref_aln</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">ref_aln</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;iqtree&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;modeltest&quot;</span> <span class="ow">in</span> <span class="n">substitution_model</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Selecting best subsitution model per modeltest-ng...&quot;</span><span class="p">)</span>
            <span class="n">wrappers</span><span class="o">.</span><span class="n">runModelTest</span><span class="p">(</span>
                <span class="n">input_algns</span><span class="o">=</span><span class="n">ref_aln</span><span class="p">,</span> <span class="n">n_processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span>
            <span class="p">)</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">get_tree_model_from_modeltest_log</span><span class="p">(</span>
                <span class="n">modeltest_log</span><span class="o">=</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;modeltest_result.log&quot;</span><span class="p">,</span>
                <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;BIC&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">modeltest_starting_tree</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;modeltest_result.tree&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;iqtest&quot;</span> <span class="ow">in</span> <span class="n">substitution_model</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
            <span class="n">modeltest_starting_tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">substitution_model</span>
            <span class="n">modeltest_starting_tree</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">wrappers</span><span class="o">.</span><span class="n">run_iqtree</span><span class="p">(</span>
            <span class="n">input_algns</span><span class="o">=</span><span class="n">ref_aln</span><span class="p">,</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
            <span class="n">output_prefix</span><span class="o">=</span><span class="s2">&quot;ref_database&quot;</span><span class="p">,</span>
            <span class="n">keep_recovery_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">substitution_model</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span>
            <span class="n">starting_tree</span><span class="o">=</span><span class="n">modeltest_starting_tree</span><span class="p">,</span>
            <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
            <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;ref_database.contree&quot;</span><span class="p">,</span>
            <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;ref_database.newick&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;fasttree&quot;</span><span class="p">:</span>
        <span class="n">wrappers</span><span class="o">.</span><span class="n">run_fasttree</span><span class="p">(</span>
            <span class="n">input_algns</span><span class="o">=</span><span class="n">ref_aln</span><span class="p">,</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;ref_database.newick&quot;</span><span class="p">,</span>
            <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_args</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wrong method, enter iqtree or fasttree&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.phylotree.relabel_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">relabel_tree</span><span class="p">(</span><span class="n">input_newick</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iTOL</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Relabel tree leaves with labels from
provided dictionary. If iTOL is set, then
labels are checked for iTOL compatibility</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_newick</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input tree in newick format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>label_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with labels to replace. Keys original labels, values new labels.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output relabelled tree. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>iTOL</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to check if label complies with iTOL requirements. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/phylotree.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">relabel_tree</span><span class="p">(</span>
    <span class="n">input_newick</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">iTOL</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relabel tree leaves with labels from</span>
<span class="sd">    provided dictionary. If iTOL is set, then</span>
<span class="sd">    labels are checked for iTOL compatibility</span>

<span class="sd">    Args:</span>
<span class="sd">        input_newick (Path): path to input tree in newick format</span>
<span class="sd">        label_dict (dict): dictionary with labels to replace. Keys original labels, values new labels.</span>
<span class="sd">        output_file (Path, optional): path to output relabelled tree. Defaults to None.</span>
<span class="sd">        iTOL (bool, optional): whether to check if label complies with iTOL requirements. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_newick</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_relabel&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iTOL</span><span class="p">:</span>
        <span class="n">sanity_check</span> <span class="o">=</span> <span class="n">sanity_check_for_iTOL</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">sanity_check</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_newick</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">sanity_check</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.phylotree.sanity_check_for_iTOL" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sanity_check_for_iTOL</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformat label to comply with iTOL requirements, remove:
1. white spaces
2. double underscores
3. symbols outside english letters and numbers</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>tree label as a string</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>reformatted label</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/phylotree.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sanity_check_for_iTOL</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reformat label to comply with iTOL requirements, remove:</span>
<span class="sd">    1. white spaces</span>
<span class="sd">    2. double underscores</span>
<span class="sd">    3. symbols outside english letters and numbers</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): tree label as a string</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: reformatted label</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">legal_chars</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[^a-zA-Z0-9]&quot;</span><span class="p">)</span>
    <span class="n">itol_label</span> <span class="o">=</span> <span class="n">legal_chars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">itol_label</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-placement">Module placement</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.placement"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to quantify and assign labels to placed sequences</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.metatag.placement.JplaceParser" class="doc doc-heading">
        <code>JplaceParser</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Methods to parse jplace files, as specified in
https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0031009</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/placement.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">JplaceParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Methods to parse jplace files, as specified in</span>
<span class="sd">    https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0031009</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_jplace</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_jplace</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="n">Phylo</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newickfy_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;tree&quot;</span><span class="p">])),</span> <span class="s2">&quot;newick&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_json_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">JSON</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print data fields</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">placements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return placement objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">newickfy_tree</span><span class="p">(</span><span class="n">tree_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove branch IDs from jplace tree string</span>

<span class="sd">        Args:</span>
<span class="sd">            tree_str (str): jplace tree string</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: newick tree string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subs_tree</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;\{(\d+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tree_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subs_tree</span>

    <span class="k">def</span> <span class="nf">get_reference_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get list of reference sequences in the placement tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">get_terminals</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">compute_tree_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find maximum (pairwise) distance between two tips</span>
<span class="sd">        (leaves) in the tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">get_terminals</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tip</span> <span class="ow">in</span> <span class="n">tips</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root_with_outgroup</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
            <span class="n">new_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">depths</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">new_max</span> <span class="o">&gt;</span> <span class="n">max_distance</span><span class="p">:</span>
                <span class="n">max_distance</span> <span class="o">=</span> <span class="n">new_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root_with_outgroup</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_distance</span>

    <span class="k">def</span> <span class="nf">filter_placements_by_minimum_lwr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">minimum_lwr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter placements by minimum LWR</span>

<span class="sd">        Args:</span>
<span class="sd">            minimum_lwr (float): LWR threshold (between 0 and 1)</span>
<span class="sd">            output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_min_lwr_</span><span class="si">{</span><span class="n">minimum_lwr</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

        <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
            <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
                <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
                <span class="k">if</span> <span class="n">lwr</span> <span class="o">&gt;=</span> <span class="n">minimum_lwr</span><span class="p">:</span>
                    <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
                <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
                <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
        <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_to_tree_diameter_ratio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">        Args:</span>
<span class="sd">            max_pendant_ratio (float): cutoff value for pendant  to tree diameter ratio</span>
<span class="sd">            output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span>
                <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_diameter_ratio_</span><span class="si">{</span><span class="n">max_pendant_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">tree_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_tree_diameter</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtering placements for tree diameter: </span><span class="si">{</span><span class="n">tree_diameter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

        <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
            <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
                <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
                <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">/</span> <span class="n">tree_diameter</span> <span class="o">&lt;=</span> <span class="n">max_pendant_ratio</span><span class="p">:</span>
                    <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
                <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
                <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
        <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_length</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">        Args:</span>
<span class="sd">            max_pendant_length (float): cutoff value for pendant length of placements</span>
<span class="sd">            output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_</span><span class="si">{</span><span class="n">max_pendant_length</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

        <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
            <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
                <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
                <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">&lt;=</span> <span class="n">max_pendant_length</span><span class="p">:</span>
                    <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
                <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
                <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
        <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_to_distal_length_ratio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">        Args:</span>
<span class="sd">            max_pendant_ratio (float): cutoff value for the pendant to</span>
<span class="sd">                distal length ratio of placements</span>
<span class="sd">            output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span>
                <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_distal_ratio_</span><span class="si">{</span><span class="n">max_pendant_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

        <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
            <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
                <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
                <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">/</span> <span class="n">distal_length</span> <span class="o">&lt;=</span> <span class="n">max_pendant_ratio</span><span class="p">:</span>
                    <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
                <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
                <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
        <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.placement.JplaceParser.fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fields</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Print data fields</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.placement.JplaceParser.meta" class="doc doc-heading">
<code class="highlight language-python"><span class="n">meta</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Print metadata</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="src.metatag.placement.JplaceParser.placements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">placements</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return placement objects</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.compute_tree_diameter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_tree_diameter</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find maximum (pairwise) distance between two tips
(leaves) in the tree</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_tree_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find maximum (pairwise) distance between two tips</span>
<span class="sd">    (leaves) in the tree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root</span>
    <span class="n">max_distance</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">get_terminals</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tip</span> <span class="ow">in</span> <span class="n">tips</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root_with_outgroup</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
        <span class="n">new_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">depths</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">new_max</span> <span class="o">&gt;</span> <span class="n">max_distance</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="n">new_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">root_with_outgroup</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_distance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.filter_placements_by_max_pendant_length" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_placements_by_max_pendant_length</span><span class="p">(</span><span class="n">max_pendant_length</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter placements by maximum pendant length</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>max_pendant_length</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>cutoff value for pendant length of placements</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_length</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">    Args:</span>
<span class="sd">        max_pendant_length (float): cutoff value for pendant length of placements</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_</span><span class="si">{</span><span class="n">max_pendant_length</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

    <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
        <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
            <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
            <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">&lt;=</span> <span class="n">max_pendant_length</span><span class="p">:</span>
                <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
            <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
            <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
    <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.filter_placements_by_max_pendant_to_distal_length_ratio" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_placements_by_max_pendant_to_distal_length_ratio</span><span class="p">(</span><span class="n">max_pendant_ratio</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter placements by maximum pendant length</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>max_pendant_ratio</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>cutoff value for the pendant to
distal length ratio of placements</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_to_distal_length_ratio</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">    Args:</span>
<span class="sd">        max_pendant_ratio (float): cutoff value for the pendant to</span>
<span class="sd">            distal length ratio of placements</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_distal_ratio_</span><span class="si">{</span><span class="n">max_pendant_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

    <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
        <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
            <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
            <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">/</span> <span class="n">distal_length</span> <span class="o">&lt;=</span> <span class="n">max_pendant_ratio</span><span class="p">:</span>
                <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
            <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
            <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
    <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.filter_placements_by_max_pendant_to_tree_diameter_ratio" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_placements_by_max_pendant_to_tree_diameter_ratio</span><span class="p">(</span><span class="n">max_pendant_ratio</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter placements by maximum pendant length</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>max_pendant_ratio</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>cutoff value for pendant  to tree diameter ratio</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_placements_by_max_pendant_to_tree_diameter_ratio</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">max_pendant_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter placements by maximum pendant length</span>

<span class="sd">    Args:</span>
<span class="sd">        max_pendant_ratio (float): cutoff value for pendant  to tree diameter ratio</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_max_pendant_diameter_ratio_</span><span class="si">{</span><span class="n">max_pendant_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">tree_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_tree_diameter</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtering placements for tree diameter: </span><span class="si">{</span><span class="n">tree_diameter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

    <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
        <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
            <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
            <span class="k">if</span> <span class="n">pendant_length</span> <span class="o">/</span> <span class="n">tree_diameter</span> <span class="o">&lt;=</span> <span class="n">max_pendant_ratio</span><span class="p">:</span>
                <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
            <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
            <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
    <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.filter_placements_by_minimum_lwr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_placements_by_minimum_lwr</span><span class="p">(</span><span class="n">minimum_lwr</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter placements by minimum LWR</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>minimum_lwr</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>LWR threshold (between 0 and 1)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_placements_by_minimum_lwr</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">minimum_lwr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter placements by minimum LWR</span>

<span class="sd">    Args:</span>
<span class="sd">        minimum_lwr (float): LWR threshold (between 0 and 1)</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_to_jplace</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;_min_lwr_</span><span class="si">{</span><span class="n">minimum_lwr</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">jplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_json_object</span><span class="p">()</span>

    <span class="n">filtered_placement_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">placement_object</span> <span class="ow">in</span> <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]:</span>
        <span class="n">filtered_placements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]:</span>
            <span class="n">edge_num</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">lwr</span><span class="p">,</span> <span class="n">distal_length</span><span class="p">,</span> <span class="n">pendant_length</span> <span class="o">=</span> <span class="n">placement</span>
            <span class="k">if</span> <span class="n">lwr</span> <span class="o">&gt;=</span> <span class="n">minimum_lwr</span><span class="p">:</span>
                <span class="n">filtered_placements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtered_placements</span><span class="p">:</span>
            <span class="n">placement_object</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placements</span>
            <span class="n">filtered_placement_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placement_object</span><span class="p">)</span>
    <span class="n">jplace</span><span class="p">[</span><span class="s2">&quot;placements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_placement_objs</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.get_reference_sequences" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_reference_sequences</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get list of reference sequences in the placement tree</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_reference_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get list of reference sequences in the placement tree</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree_obj</span><span class="o">.</span><span class="n">get_terminals</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.JplaceParser.newickfy_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">newickfy_tree</span><span class="p">(</span><span class="n">tree_str</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove branch IDs from jplace tree string</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tree_str</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>jplace tree string</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>newick tree string</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">newickfy_tree</span><span class="p">(</span><span class="n">tree_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove branch IDs from jplace tree string</span>

<span class="sd">    Args:</span>
<span class="sd">        tree_str (str): jplace tree string</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: newick tree string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subs_tree</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;\{(\d+)\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tree_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subs_tree</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.placement.TaxAssignParser" class="doc doc-heading">
        <code>TaxAssignParser</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Parse function and taxonomy placement assignments table</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/placement.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxAssignParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse function and taxonomy placement assignments table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_assign_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse function and taxonomy placement assignments table</span>

<span class="sd">        Args:</span>
<span class="sd">            tax_assign_path (Path): path to tsv file containing taxonomic assignments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tax_assign_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">!=</span> <span class="s2">&quot;DISTANT&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;cluster_score&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span><span class="s2">&quot;cluster_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_taxopath</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">taxopath</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">taxlevels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Taxopath</span><span class="p">()</span><span class="o">.</span><span class="n">taxlevels</span>

    <span class="k">def</span> <span class="nf">count_hits</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">taxopath_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;taxopath&quot;</span><span class="p">,</span>
        <span class="n">path_to_query_list</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaxonomyCounter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count hits within given cluster ids and at specificied taxon level</span>

<span class="sd">        Args:</span>
<span class="sd">            cluster_ids (list[str], optional): IDs of tree clusters to be included</span>
<span class="sd">                in the counting of placements. Defaults to None.</span>
<span class="sd">            score_threshold (float, optional): global placement score threshold to filter</span>
<span class="sd">                low-quality placements out. Defaults to None.</span>
<span class="sd">            taxopath_type (str, optional): &#39;taxopath&#39; to use gappa-assign taxopath or</span>
<span class="sd">                &#39;cluster_taxopath&#39; to use lowest common taxopath of the reference tree cluster.</span>
<span class="sd">                Defaults to &quot;taxopath&quot;.</span>
<span class="sd">            path_to_query_list (Path, optional): if not None, then a tsv is exported to</span>
<span class="sd">                defined location containing those queries with correct cluster assignment (</span>
<span class="sd">                according to defined &#39;valid&#39; cluster ids or threshold). Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TaxonomyCounter: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cluster_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">score_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">score_threshold</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">query_hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cluster_ids</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">path_to_query_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_hits</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_query_list</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">taxopath_hits</span> <span class="o">=</span> <span class="n">query_hits</span><span class="p">[</span><span class="n">taxopath_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxopath_hits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;No placement hits returned for the provided filter parameters&quot;</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">taxlevel_counter</span> <span class="o">=</span> <span class="n">TaxonomyCounter</span><span class="p">(</span><span class="n">taxopath_list</span><span class="o">=</span><span class="n">taxopath_hits</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">taxlevel_counter</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.TaxAssignParser.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tax_assign_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Parse function and taxonomy placement assignments table</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tax_assign_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv file containing taxonomic assignments</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_assign_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse function and taxonomy placement assignments table</span>

<span class="sd">    Args:</span>
<span class="sd">        tax_assign_path (Path): path to tsv file containing taxonomic assignments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tax_assign_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span> <span class="o">!=</span> <span class="s2">&quot;DISTANT&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;cluster_score&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span><span class="s2">&quot;cluster_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_taxopath</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">taxopath</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.placement.TaxAssignParser.count_hits" class="doc doc-heading">
<code class="highlight language-python"><span class="n">count_hits</span><span class="p">(</span><span class="n">cluster_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">taxopath_type</span><span class="o">=</span><span class="s1">&#39;taxopath&#39;</span><span class="p">,</span> <span class="n">path_to_query_list</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Count hits within given cluster ids and at specificied taxon level</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cluster_ids</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>IDs of tree clusters to be included
in the counting of placements. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>score_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>global placement score threshold to filter
low-quality placements out. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>taxopath_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>'taxopath' to use gappa-assign taxopath or
'cluster_taxopath' to use lowest common taxopath of the reference tree cluster.
Defaults to "taxopath".</p></td>
          <td>
                <code>&#39;taxopath&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>path_to_query_list</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if not None, then a tsv is exported to
defined location containing those queries with correct cluster assignment (
according to defined 'valid' cluster ids or threshold). Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>TaxonomyCounter</code></td>          <td>
                <code><span title="metatag.taxonomy.TaxonomyCounter">TaxonomyCounter</span></code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">count_hits</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cluster_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">taxopath_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;taxopath&quot;</span><span class="p">,</span>
    <span class="n">path_to_query_list</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaxonomyCounter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count hits within given cluster ids and at specificied taxon level</span>

<span class="sd">    Args:</span>
<span class="sd">        cluster_ids (list[str], optional): IDs of tree clusters to be included</span>
<span class="sd">            in the counting of placements. Defaults to None.</span>
<span class="sd">        score_threshold (float, optional): global placement score threshold to filter</span>
<span class="sd">            low-quality placements out. Defaults to None.</span>
<span class="sd">        taxopath_type (str, optional): &#39;taxopath&#39; to use gappa-assign taxopath or</span>
<span class="sd">            &#39;cluster_taxopath&#39; to use lowest common taxopath of the reference tree cluster.</span>
<span class="sd">            Defaults to &quot;taxopath&quot;.</span>
<span class="sd">        path_to_query_list (Path, optional): if not None, then a tsv is exported to</span>
<span class="sd">            defined location containing those queries with correct cluster assignment (</span>
<span class="sd">            according to defined &#39;valid&#39; cluster ids or threshold). Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TaxonomyCounter: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cluster_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">score_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">score_threshold</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">query_hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cluster_ids</span><span class="p">))</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_assign</span><span class="o">.</span><span class="n">cluster_score</span> <span class="o">&gt;=</span> <span class="n">score_threshold</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">path_to_query_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query_hits</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_to_query_list</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">taxopath_hits</span> <span class="o">=</span> <span class="n">query_hits</span><span class="p">[</span><span class="n">taxopath_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxopath_hits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;No placement hits returned for the provided filter parameters&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">taxlevel_counter</span> <span class="o">=</span> <span class="n">TaxonomyCounter</span><span class="p">(</span><span class="n">taxopath_list</span><span class="o">=</span><span class="n">taxopath_hits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">taxlevel_counter</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.add_clusters_to_tax_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_clusters_to_tax_table</span><span class="p">(</span><span class="n">in_taxtable</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_taxtable</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add tree cluster info at the beginning of each taxopath
according to clusters defined in dictionary 'clusters'</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>in_taxtable</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to taxonomy table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>clusters</code></td>
          <td>
                <code>dict, optionall</code>
          </td>
          <td><p>dictionary with keys equal to cluster IDs
and values to lists of cluster members. If None, then all sequences
are assumed to belong to the same cluster. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>out_taxtable</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output taxonomy table. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_clusters_to_tax_table</span><span class="p">(</span>
    <span class="n">in_taxtable</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">clusters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out_taxtable</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add tree cluster info at the beginning of each taxopath</span>
<span class="sd">    according to clusters defined in dictionary &#39;clusters&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        in_taxtable (Path): path to taxonomy table</span>
<span class="sd">        clusters (dict, optionall): dictionary with keys equal to cluster IDs</span>
<span class="sd">            and values to lists of cluster members. If None, then all sequences</span>
<span class="sd">            are assumed to belong to the same cluster. Defaults to None.</span>
<span class="sd">        out_taxtable (Path, optional): path to output taxonomy table. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">out_taxtable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_taxtable</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">in_taxtable</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_clustered&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out_taxtable</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_taxtable</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">taxtable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_taxtable</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">taxtable</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;C0&quot;</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">taxtable</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_taxtable</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.add_duplicates_to_assignment_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_duplicates_to_assignment_table</span><span class="p">(</span><span class="n">taxtable</span><span class="p">,</span> <span class="n">query_duplicates</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add duplicated query IDs to cluster and taxonomic assignment table</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>taxtable</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to cluster and taxonomic assignment table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_duplicates</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query duplicates file as output by seqkit rmdup</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_duplicates_to_assignment_table</span><span class="p">(</span>
    <span class="n">taxtable</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">query_duplicates</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add duplicated query IDs to cluster and taxonomic assignment table</span>

<span class="sd">    Args:</span>
<span class="sd">        taxtable (Path): path to cluster and taxonomic assignment table</span>
<span class="sd">        query_duplicates (Path): path to query duplicates file as output by seqkit rmdup</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">taxtable</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_duplicates&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">duplicated_hits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">assigns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">taxtable</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dup_dict</span> <span class="o">=</span> <span class="n">parse_duplicates_from_seqkit</span><span class="p">(</span><span class="n">query_duplicates</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">duplicate_string</span> <span class="ow">in</span> <span class="n">dup_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">duplicate_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">duplicated_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">duplicate</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">assigns</span><span class="p">[</span><span class="n">assigns</span><span class="o">.</span><span class="n">query_name</span> <span class="o">==</span> <span class="n">query_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">row</span><span class="o">.</span><span class="n">query_name</span> <span class="o">=</span> <span class="n">duplicate</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">duplicated_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">duplicated_hits</span><span class="p">:</span>
        <span class="n">assigns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">assigns</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">duplicated_hits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">assigns</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.add_query_labels_to_assign_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_query_labels_to_assign_table</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">query_labels</span><span class="p">,</span> <span class="n">output_table</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add new column containing actual query labels to query taxonomy/cluster
assignment table</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_table</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query taxonomy/cluster assignment table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_labels</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with keys equal to query short IDs
and values to query labels</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_table</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output table. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_query_labels_to_assign_table</span><span class="p">(</span>
    <span class="n">input_table</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">query_labels</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_table</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add new column containing actual query labels to query taxonomy/cluster</span>
<span class="sd">    assignment table</span>

<span class="sd">    Args:</span>
<span class="sd">        input_table (Path): path to query taxonomy/cluster assignment table</span>
<span class="sd">        query_labels (dict): dictionary with keys equal to query short IDs</span>
<span class="sd">            and values to query labels</span>
<span class="sd">        output_table (Path, optional): path to output table. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">relabel_query</span><span class="p">(</span><span class="n">query_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query_labels</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query_labels</span><span class="p">[</span><span class="n">query_id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">query_id</span>

    <span class="k">if</span> <span class="n">output_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_table</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_relabel&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_table</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_table</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
        <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query_name&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">query_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">relabel_query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">query_labels</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;query_id&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_table</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.assign_labels_to_placements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_labels_to_placements</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">ref_labels</span><span class="p">,</span> <span class="n">query_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_best_hit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ref_clusters_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_cluster_scores_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gappa_additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_unique_cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">taxo_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Assign taxonomy and/or tree cluster IDs to placed query sequences based on
taxonomy assigned to tree reference sequences using gappa examine assign.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>jplace</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to jplace file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_labels</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary containing short IDs as keys and long
labels as values for reference sequences</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_labels</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary containing short IDs as keys
and long labels as values for query sequences. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to output files. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>only_best_hit</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>only report taxonomy with largest LWR
per query. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_clusters_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv containing reference
cluster definitions. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_cluster_scores_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv containing cluster
scores. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>gappa_additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to gappa.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>only_unique_cluster</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, keep only queries with
multiple placement locations if they were assigned to the same
cluster. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>taxo_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to taxonomy database. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_labels_to_placements</span><span class="p">(</span>
    <span class="n">jplace</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">ref_labels</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">query_labels</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">only_best_hit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ref_clusters_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ref_cluster_scores_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gappa_additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">only_unique_cluster</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">taxo_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign taxonomy and/or tree cluster IDs to placed query sequences based on</span>
<span class="sd">    taxonomy assigned to tree reference sequences using gappa examine assign.</span>

<span class="sd">    Args:</span>
<span class="sd">        jplace (Path): path to jplace file</span>
<span class="sd">        ref_labels (dict): dictionary containing short IDs as keys and long</span>
<span class="sd">            labels as values for reference sequences</span>
<span class="sd">        query_labels (dict, optional): dictionary containing short IDs as keys</span>
<span class="sd">            and long labels as values for query sequences. Defaults to None.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        output_prefix (str, optional): prefix to output files. Defaults to None.</span>
<span class="sd">        only_best_hit (bool, optional): only report taxonomy with largest LWR</span>
<span class="sd">            per query. Defaults to True.</span>
<span class="sd">        ref_clusters_file (Path, optional): path to tsv containing reference</span>
<span class="sd">            cluster definitions. Defaults to None.</span>
<span class="sd">        ref_cluster_scores_file (Path, optional): path to tsv containing cluster</span>
<span class="sd">            scores. Defaults to None.</span>
<span class="sd">        gappa_additional_args (str, optional): additional arguments to gappa.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        only_unique_cluster (bool, optional): if True, keep only queries with</span>
<span class="sd">            multiple placement locations if they were assigned to the same</span>
<span class="sd">            cluster. Defaults to True.</span>
<span class="sd">        taxo_file (Path, optional): path to taxonomy database. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_prefix</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ref_clusters_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">defined_clusters</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ref_clusters</span> <span class="o">=</span> <span class="n">parse_tree_clusters</span><span class="p">(</span><span class="n">ref_clusters_file</span><span class="p">,</span> <span class="n">cluster_as_key</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ref_clusters_as_keys</span> <span class="o">=</span> <span class="n">parse_tree_clusters</span><span class="p">(</span>
            <span class="n">ref_clusters_file</span><span class="p">,</span> <span class="n">cluster_as_key</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">defined_clusters</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ref_clusters</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">ref_cluster_scores_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_cluster_scores</span> <span class="o">=</span> <span class="n">parse_tree_cluster_quality_scores</span><span class="p">(</span><span class="n">ref_cluster_scores_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ref_cluster_scores</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">taxo_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">taxo_file</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;merged_taxonomy.tsv&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">taxo_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">taxo_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">gappa_assign_out</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">per_query.tsv&quot;</span>
    <span class="n">query_taxo_out</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">assignments.tsv&quot;</span>

    <span class="c1"># Remove references that are not in placement tree</span>
    <span class="n">ref_in_jplace_tree</span> <span class="o">=</span> <span class="n">JplaceParser</span><span class="p">(</span><span class="n">jplace</span><span class="p">)</span><span class="o">.</span><span class="n">get_reference_sequences</span><span class="p">()</span>
    <span class="n">ref_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ref_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ref_in_jplace_tree</span><span class="p">}</span>

    <span class="k">with</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">temptax</span><span class="p">:</span>
        <span class="n">taxonomy</span> <span class="o">=</span> <span class="n">TaxonomyAssigner</span><span class="p">(</span><span class="n">taxo_file</span><span class="o">=</span><span class="n">taxo_file</span><span class="p">)</span>
        <span class="n">taxonomy</span><span class="o">.</span><span class="n">build_gappa_taxonomy_table</span><span class="p">(</span><span class="n">ref_labels</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">temptax</span><span class="p">)</span>
        <span class="n">add_clusters_to_tax_table</span><span class="p">(</span>
            <span class="n">in_taxtable</span><span class="o">=</span><span class="n">temptax</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="n">ref_clusters</span><span class="p">,</span> <span class="n">out_taxtable</span><span class="o">=</span><span class="n">temptax</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">defined_clusters</span><span class="p">:</span>
            <span class="n">clusters_taxopath</span> <span class="o">=</span> <span class="n">taxonomy</span><span class="o">.</span><span class="n">assign_lowest_common_taxonomy_to_clusters</span><span class="p">(</span>
                <span class="n">clusters</span><span class="o">=</span><span class="n">ref_clusters_as_keys</span><span class="p">,</span> <span class="n">label_dict</span><span class="o">=</span><span class="n">ref_labels</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clusters_taxopath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">wrappers</span><span class="o">.</span><span class="n">run_gappa_assign</span><span class="p">(</span>
            <span class="n">jplace</span><span class="o">=</span><span class="n">jplace</span><span class="p">,</span>
            <span class="n">taxonomy_file</span><span class="o">=</span><span class="n">temptax</span><span class="p">,</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
            <span class="n">output_prefix</span><span class="o">=</span><span class="n">output_prefix</span><span class="p">,</span>
            <span class="n">only_best_hit</span><span class="o">=</span><span class="n">only_best_hit</span><span class="p">,</span>
            <span class="n">additional_args</span><span class="o">=</span><span class="n">gappa_additional_args</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">with</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempout</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempout2</span><span class="p">,</span> <span class="n">TemporaryFilePath</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempout3</span><span class="p">:</span>
        <span class="n">parse_gappa_assign_table</span><span class="p">(</span>
            <span class="n">input_table</span><span class="o">=</span><span class="n">gappa_assign_out</span><span class="p">,</span>
            <span class="n">has_cluster_id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cluster_scores</span><span class="o">=</span><span class="n">ref_cluster_scores</span><span class="p">,</span>
            <span class="n">output_file</span><span class="o">=</span><span class="n">tempout</span><span class="p">,</span>
            <span class="n">clusters_taxopath</span><span class="o">=</span><span class="n">clusters_taxopath</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">only_unique_cluster</span> <span class="ow">and</span> <span class="n">defined_clusters</span><span class="p">:</span>
            <span class="n">filter_non_unique_placement_assignments</span><span class="p">(</span>
                <span class="n">placed_tax_assignments</span><span class="o">=</span><span class="n">tempout</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">tempout2</span>
            <span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempout2</span><span class="p">,</span> <span class="n">tempout</span><span class="p">)</span>

        <span class="n">pick_taxopath_with_highest_lwr</span><span class="p">(</span>
            <span class="n">placed_tax_assignments</span><span class="o">=</span><span class="n">tempout</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">tempout3</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">query_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">add_query_labels_to_assign_table</span><span class="p">(</span>
                <span class="n">input_table</span><span class="o">=</span><span class="n">tempout3</span><span class="p">,</span>
                <span class="n">query_labels</span><span class="o">=</span><span class="n">query_labels</span><span class="p">,</span>
                <span class="n">output_table</span><span class="o">=</span><span class="n">query_taxo_out</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempout3</span><span class="p">,</span> <span class="n">query_taxo_out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.filter_non_unique_placement_assignments" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_non_unique_placement_assignments</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Remove queries that were assigned to more than one cluster from
   placements assignments table</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>placed_tax_assignments</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to placed taxonomic assignments table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_non_unique_placement_assignments</span><span class="p">(</span>
    <span class="n">placed_tax_assignments</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove queries that were assigned to more than one cluster from</span>
<span class="sd">       placements assignments table</span>

<span class="sd">    Args:</span>
<span class="sd">        placed_tax_assignments (Path): path to placed taxonomic assignments table</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_filtered&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">queries_in_more_than_one_cluster</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_queries_placed_in_several_clusters</span><span class="p">(</span>
        <span class="n">placed_tax_assignments</span>
    <span class="p">)</span>
    <span class="n">fdf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">query_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">queries_in_more_than_one_cluster</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;query_id&quot;</span><span class="p">)</span>
    <span class="n">fdf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.find_queries_placed_in_several_clusters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_queries_placed_in_several_clusters</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Find queries placed in more than one cluster</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>placed_tax_assignments</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to placed taxonomic assignments table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple[list, <span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td><p>tuple[list, pd.DataFrame]: list of query IDs placed in more than
one cluster and dataframe with unique cluster assignments per query</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_queries_placed_in_several_clusters</span><span class="p">(</span>
    <span class="n">placed_tax_assignments</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find queries placed in more than one cluster</span>

<span class="sd">    Args:</span>
<span class="sd">        placed_tax_assignments (Path): path to placed taxonomic assignments table</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[list, pd.DataFrame]: list of query IDs placed in more than</span>
<span class="sd">            one cluster and dataframe with unique cluster assignments per query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">dfu</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;query_id&quot;</span><span class="p">)[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;unique&quot;</span><span class="p">])</span>

    <span class="n">queries_in_more_than_one_cluster</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfu</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">queries_in_more_than_one_cluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">queries_in_more_than_one_cluster</span><span class="p">,</span> <span class="n">dfu</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.parse_duplicates_from_seqkit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_duplicates_from_seqkit</span><span class="p">(</span><span class="n">query_duplicates</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add a column with the query IDs of duplicated sequences to the taxonomy assignments file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query_duplicates</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query duplicates file as output by seqkit rmdup</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
                <code>None</code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_duplicates_from_seqkit</span><span class="p">(</span><span class="n">query_duplicates</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a column with the query IDs of duplicated sequences to the taxonomy assignments file.</span>

<span class="sd">    Args:</span>
<span class="sd">        query_duplicates (Path): path to query duplicates file as output by seqkit rmdup</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">query_duplicates</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">dup_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">dup_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">seq_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">dup_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dup_pair</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dup_labels</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.parse_gappa_assign_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_gappa_assign_table</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">has_cluster_id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cluster_scores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clusters_taxopath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse gappa assign per query taxonomy assignment result tsv</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_table</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to gappa assign per query taxonomy assignment result tsv</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>has_cluster_id</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>set to True if results table includes reference
cluster info in the first element of taxopath. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cluster_scores</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with values set to cluster quality
scores. It is only used if has_cluster_id = True. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>clusters_taxopath</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dict with keys equal to cluster IDs and values
corresponding to the lowest common taxopath for the cluster. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_gappa_assign_table</span><span class="p">(</span>
    <span class="n">input_table</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">has_cluster_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">cluster_scores</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">clusters_taxopath</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse gappa assign per query taxonomy assignment result tsv</span>

<span class="sd">    Args:</span>
<span class="sd">        input_table (Path): path to gappa assign per query taxonomy assignment result tsv</span>
<span class="sd">        has_cluster_id (bool, optional): set to True if results table includes reference</span>
<span class="sd">            cluster info in the first element of taxopath. Defaults to True.</span>
<span class="sd">        cluster_scores (dict, optional): dictionary with values set to cluster quality</span>
<span class="sd">            scores. It is only used if has_cluster_id = True. Defaults to None.</span>
<span class="sd">        clusters_taxopath (dict, optional): dict with keys equal to cluster IDs and values</span>
<span class="sd">            corresponding to the lowest common taxopath for the cluster. Defaults to None.</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_parsed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">has_cluster_id</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cluster_scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">cluster_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;cluster_id&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;cluster_score&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;cluster_taxopath&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">has_cluster_id</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cluster_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">cluster_str</span> <span class="o">=</span> <span class="s2">&quot;cluster_id&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;cluster_taxopath&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_cluster_id</span><span class="p">:</span>
        <span class="n">cluster_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_table</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;query_id&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;LWR&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">cluster_str</span> <span class="o">+</span> <span class="s2">&quot;taxopath&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">taxopath</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">taxopath</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">taxopath</span> <span class="o">+</span> <span class="s2">&quot;;Unspecified&quot;</span>
            <span class="k">if</span> <span class="n">has_cluster_id</span><span class="p">:</span>
                <span class="n">elems</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">taxopath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">clusters_taxopath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">clusters_taxopath</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="n">cluster_taxopath</span> <span class="o">=</span> <span class="n">clusters_taxopath</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster_taxopath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cluster_taxopath</span><span class="p">:</span>
                    <span class="n">cluster_taxopath</span> <span class="o">=</span> <span class="s2">&quot;Unspecified&quot;</span>
                <span class="n">taxopath</span> <span class="o">=</span> <span class="n">cluster_taxopath</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cluster_id</span><span class="p">,</span> <span class="n">taxopath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">taxopath</span>
            <span class="k">if</span> <span class="n">cluster_scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">cluster_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cluster_score</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cluster_scores</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster_score</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LWR&quot;</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">cluster_id</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">cluster_score</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">taxopath</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LWR&quot;</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">cluster_id</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">taxopath</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.parse_tree_cluster_quality_scores" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_tree_cluster_quality_scores</span><span class="p">(</span><span class="n">cluster_scores_tsv</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse cluster quality scores file into dictionary</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cluster_scores_tsv</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv containing cluster scores</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>dict with keys equal to cluster IDs and values to scores</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_tree_cluster_quality_scores</span><span class="p">(</span><span class="n">cluster_scores_tsv</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse cluster quality scores file into dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        cluster_scores_tsv (Path): path to tsv containing cluster scores</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: dict with keys equal to cluster IDs and values to scores</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">cluster_scores_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.parse_tree_clusters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_tree_clusters</span><span class="p">(</span><span class="n">clusters_tsv</span><span class="p">,</span> <span class="n">cluster_as_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parse clusters text file into dictionary</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clusters_tsv</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tsv containing tree cluster definitions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cluster_as_key</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True then dict keys are cluster IDs and values</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_tree_clusters</span><span class="p">(</span><span class="n">clusters_tsv</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">cluster_as_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse clusters text file into dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        clusters_tsv (Path): path to tsv containing tree cluster definitions</span>
<span class="sd">        cluster_as_key (bool, optional): if True then dict keys are cluster IDs and values</span>
<span class="sd">        are lists of reference IDs. If False, dict keys are reference IDs and</span>
<span class="sd">        values the cluster to which they belong.. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">clusters_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cluster_as_key</span><span class="p">:</span>
        <span class="n">cluster_ids</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">cluster_id</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">cluster_ids</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.pick_taxopath_with_highest_lwr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pick_taxopath_with_highest_lwr</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Pick taxopath assigment with higuest LWR for each placed query</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>placed_tax_assignments</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to placed taxonomic assignments table</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pick_taxopath_with_highest_lwr</span><span class="p">(</span>
    <span class="n">placed_tax_assignments</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pick taxopath assigment with higuest LWR for each placed query</span>

<span class="sd">    Args:</span>
<span class="sd">        placed_tax_assignments (Path): path to placed taxonomic assignments table</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_unique_taxopath&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">placed_tax_assignments</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;query_id&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;LWR&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="n">output_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.placement.place_reads_onto_tree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">place_reads_onto_tree</span><span class="p">(</span><span class="n">input_tree</span><span class="p">,</span> <span class="n">tree_model</span><span class="p">,</span> <span class="n">ref_aln</span><span class="p">,</span> <span class="n">query_seqs</span><span class="p">,</span> <span class="n">aln_method</span><span class="o">=</span><span class="s1">&#39;papara&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs short read placement onto phylogenetic tree
tree_model: str, either the model name or path to log output by iqtree
workflow example: https://github.com/Pbdas/epa-ng/wiki/Full-Stack-Example</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_tree</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input tree</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tree_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>substitution model used for tree inference</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference alignment</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_seqs</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query sequences</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>aln_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose either "papara" or "hmmalign". Defaults to "papara".</p></td>
          <td>
                <code>&#39;papara&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/placement.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">place_reads_onto_tree</span><span class="p">(</span>
    <span class="n">input_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">tree_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">ref_aln</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">query_seqs</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">aln_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;papara&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs short read placement onto phylogenetic tree</span>
<span class="sd">    tree_model: str, either the model name or path to log output by iqtree</span>
<span class="sd">    workflow example: https://github.com/Pbdas/epa-ng/wiki/Full-Stack-Example</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tree (Path): path to input tree</span>
<span class="sd">        tree_model (str): substitution model used for tree inference</span>
<span class="sd">        ref_aln (Path): path to reference alignment</span>
<span class="sd">        query_seqs (Path): path to query sequences</span>
<span class="sd">        aln_method (str, optional): choose either &quot;papara&quot; or &quot;hmmalign&quot;. Defaults to &quot;papara&quot;.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">query_seqs</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">tree_model</span> <span class="o">=</span> <span class="n">get_iq_tree_model_from_log_file</span><span class="p">(</span><span class="n">tree_model</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running EPA-ng with inferred substitution model: </span><span class="si">{</span><span class="n">tree_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ref_ids</span> <span class="o">=</span> <span class="n">get_fasta_record_ids</span><span class="p">(</span><span class="n">ref_aln</span><span class="p">)</span>
    <span class="n">ref_query_msa</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">query_seqs</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">aln_ref_frac</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_ref_fraction&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span>
    <span class="p">)</span>
    <span class="n">aln_query_frac</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
        <span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_query_fraction&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.faln&quot;</span>
    <span class="p">)</span>

    <span class="n">align_short_reads_to_reference_msa</span><span class="p">(</span>
        <span class="n">ref_msa</span><span class="o">=</span><span class="n">ref_aln</span><span class="p">,</span>
        <span class="n">query_seqs</span><span class="o">=</span><span class="n">query_seqs</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">aln_method</span><span class="p">,</span>
        <span class="n">tree_nwk</span><span class="o">=</span><span class="n">input_tree</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">split_reference_from_query_alignments</span><span class="p">(</span>
        <span class="n">ref_query_msa</span><span class="o">=</span><span class="n">ref_query_msa</span><span class="p">,</span> <span class="n">ref_ids</span><span class="o">=</span><span class="n">ref_ids</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span>
    <span class="p">)</span>

    <span class="n">wrappers</span><span class="o">.</span><span class="n">run_epang</span><span class="p">(</span>
        <span class="n">input_tree</span><span class="o">=</span><span class="n">input_tree</span><span class="p">,</span>
        <span class="n">input_aln_ref</span><span class="o">=</span><span class="n">aln_ref_frac</span><span class="p">,</span>
        <span class="n">input_aln_query</span><span class="o">=</span><span class="n">aln_query_frac</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">tree_model</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-taxonomy">Module taxonomy</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.taxonomy"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to assign taxonomy to reference and query (placed) sequences</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.metatag.taxonomy.TaxonomyAssigner" class="doc doc-heading">
        <code>TaxonomyAssigner</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Methods to assign taxonomy to reference sequences</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxonomyAssigner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Methods to assign taxonomy to reference sequences</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxo_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taxodata</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">taxo_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;genome&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;genome&quot;</span><span class="p">)</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Methods to assign taxonomy to reference sequences</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">lowest_common_taxonomy</span><span class="p">(</span><span class="n">taxopaths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find lowest common taxonomy among set of taxopaths</span>

<span class="sd">        Args:</span>
<span class="sd">            taxopaths (list[str]): list of taxopath strings</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: lowest common taxopaht</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">taxopaths</span><span class="p">])</span>
        <span class="n">taxlevels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;d__&quot;</span><span class="p">,</span> <span class="s2">&quot;p__&quot;</span><span class="p">,</span> <span class="s2">&quot;c__&quot;</span><span class="p">,</span> <span class="s2">&quot;o__&quot;</span><span class="p">,</span> <span class="s2">&quot;f__&quot;</span><span class="p">,</span> <span class="s2">&quot;g__&quot;</span><span class="p">,</span> <span class="s2">&quot;s__&quot;</span><span class="p">]</span>
        <span class="n">lowest_tax</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tax_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">taxlevels</span><span class="p">):</span>
            <span class="n">taxa</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxa</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">lowest_tax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lowest_tax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_genome_id_from_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">genome_id</span> <span class="o">=</span> <span class="n">LabelParser</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">extract_genome_id</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">genome_id</span>

    <span class="k">def</span> <span class="nf">assign_taxonomy_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign GTDB taxonomy to label based on genome ID</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str): reference label containing genome ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: GTDB taxonomy as a string taxopath</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genome_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_genome_id_from_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxodata</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxodata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No_taxonomy_found&quot;</span>

    <span class="k">def</span> <span class="nf">assign_lowest_common_taxonomy_to_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assing taxonomy to set of labels and find lowest common taxonomy</span>
<span class="sd">        among them</span>

<span class="sd">        Args:</span>
<span class="sd">            labels (list[str]): list of reference labels containing genome IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: lowest common GTDB taxonomy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">taxopaths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">taxopath</span>
            <span class="k">for</span> <span class="n">taxopath</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_taxonomy_to_label</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">taxopath</span> <span class="o">!=</span> <span class="s2">&quot;No_taxonomy_found&quot;</span>
        <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">taxopaths</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowest_common_taxonomy</span><span class="p">(</span><span class="n">taxopaths</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Unspecified&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unspecified&quot;</span>

    <span class="k">def</span> <span class="nf">assign_lowest_common_taxonomy_to_clusters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find lowest possible common taxonomy to reference labels in clusters</span>
<span class="sd">        If reference labels do not contain genome IDs, a dictionary, label_dict,</span>
<span class="sd">        of reference labels and genome ids (or labels with genome ids) must be passed</span>

<span class="sd">        Args:</span>
<span class="sd">            clusters (dict): dictionary with keys as cluster IDs and values as lists</span>
<span class="sd">                of reference labels in each cluster</span>
<span class="sd">            label_dict (dict, optional): dictionary with keys as short IDs and values</span>
<span class="sd">                as reference (full) labels. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary with keys as cluster IDs and values as lowest common</span>
<span class="sd">                taxopath for each cluster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clusters_taxopath</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">label_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cluster_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_dict</span><span class="p">[</span><span class="n">ref_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">ref_id</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">cluster</span>
            <span class="n">taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_lowest_common_taxonomy_to_labels</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">)</span>
            <span class="n">clusters_taxopath</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxopath</span>
        <span class="k">return</span> <span class="n">clusters_taxopath</span>

    <span class="k">def</span> <span class="nf">build_gappa_taxonomy_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ref_id_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build gappa-compatible taxonomy file as specified here:</span>
<span class="sd">        https://github.com/lczech/gappa/wiki/Subcommand:-assign</span>
<span class="sd">        Removes references without assigned taxonomy</span>

<span class="sd">        Args:</span>
<span class="sd">            ref_id_dict (dict): dictionary with keys as reference IDs and values as</span>
<span class="sd">                reference labels</span>
<span class="sd">            output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;gappa_taxonomy.tsv&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ref_id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ref_id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">taxon_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_taxonomy_to_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">taxon_str</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;No_taxonomy_found&quot;</span> <span class="ow">in</span> <span class="n">taxon_str</span><span class="p">)</span> <span class="k">else</span> <span class="n">taxon_str</span>
                <span class="p">)</span>
                <span class="c1"># if taxon_str != &#39;Unspecified&#39;:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_id</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">taxon_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyAssigner.assign_lowest_common_taxonomy_to_clusters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_lowest_common_taxonomy_to_clusters</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">label_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find lowest possible common taxonomy to reference labels in clusters
If reference labels do not contain genome IDs, a dictionary, label_dict,
of reference labels and genome ids (or labels with genome ids) must be passed</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clusters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with keys as cluster IDs and values as lists
of reference labels in each cluster</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>label_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with keys as short IDs and values
as reference (full) labels. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with keys as cluster IDs and values as lowest common
taxopath for each cluster</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_lowest_common_taxonomy_to_clusters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">label_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find lowest possible common taxonomy to reference labels in clusters</span>
<span class="sd">    If reference labels do not contain genome IDs, a dictionary, label_dict,</span>
<span class="sd">    of reference labels and genome ids (or labels with genome ids) must be passed</span>

<span class="sd">    Args:</span>
<span class="sd">        clusters (dict): dictionary with keys as cluster IDs and values as lists</span>
<span class="sd">            of reference labels in each cluster</span>
<span class="sd">        label_dict (dict, optional): dictionary with keys as short IDs and values</span>
<span class="sd">            as reference (full) labels. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: dictionary with keys as cluster IDs and values as lowest common</span>
<span class="sd">            taxopath for each cluster</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clusters_taxopath</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">label_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_dict</span><span class="p">[</span><span class="n">ref_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">ref_id</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster_labels</span> <span class="o">=</span> <span class="n">cluster</span>
        <span class="n">taxopath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_lowest_common_taxonomy_to_labels</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">)</span>
        <span class="n">clusters_taxopath</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxopath</span>
    <span class="k">return</span> <span class="n">clusters_taxopath</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyAssigner.assign_lowest_common_taxonomy_to_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_lowest_common_taxonomy_to_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assing taxonomy to set of labels and find lowest common taxonomy
among them</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of reference labels containing genome IDs</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>lowest common GTDB taxonomy</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_lowest_common_taxonomy_to_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assing taxonomy to set of labels and find lowest common taxonomy</span>
<span class="sd">    among them</span>

<span class="sd">    Args:</span>
<span class="sd">        labels (list[str]): list of reference labels containing genome IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: lowest common GTDB taxonomy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">taxopaths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">taxopath</span>
        <span class="k">for</span> <span class="n">taxopath</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assign_taxonomy_to_label</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">taxopath</span> <span class="o">!=</span> <span class="s2">&quot;No_taxonomy_found&quot;</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">taxopaths</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowest_common_taxonomy</span><span class="p">(</span><span class="n">taxopaths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unspecified&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Unspecified&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyAssigner.assign_taxonomy_to_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_taxonomy_to_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Assign GTDB taxonomy to label based on genome ID</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>reference label containing genome ID</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>GTDB taxonomy as a string taxopath</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_taxonomy_to_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign GTDB taxonomy to label based on genome ID</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): reference label containing genome ID</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: GTDB taxonomy as a string taxopath</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">genome_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_genome_id_from_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxodata</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxodata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;No_taxonomy_found&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyAssigner.build_gappa_taxonomy_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_gappa_taxonomy_table</span><span class="p">(</span><span class="n">ref_id_dict</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Build gappa-compatible taxonomy file as specified here:
https://github.com/lczech/gappa/wiki/Subcommand:-assign
Removes references without assigned taxonomy</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ref_id_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary with keys as reference IDs and values as
reference labels</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_gappa_taxonomy_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">ref_id_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build gappa-compatible taxonomy file as specified here:</span>
<span class="sd">    https://github.com/lczech/gappa/wiki/Subcommand:-assign</span>
<span class="sd">    Removes references without assigned taxonomy</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_id_dict (dict): dictionary with keys as reference IDs and values as</span>
<span class="sd">            reference labels</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;gappa_taxonomy.tsv&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ref_id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ref_id_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">taxon_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_taxonomy_to_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">taxon_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;No_taxonomy_found&quot;</span> <span class="ow">in</span> <span class="n">taxon_str</span><span class="p">)</span> <span class="k">else</span> <span class="n">taxon_str</span>
            <span class="p">)</span>
            <span class="c1"># if taxon_str != &#39;Unspecified&#39;:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_id</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">taxon_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyAssigner.lowest_common_taxonomy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lowest_common_taxonomy</span><span class="p">(</span><span class="n">taxopaths</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Find lowest common taxonomy among set of taxopaths</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>taxopaths</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of taxopath strings</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>lowest common taxopaht</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">lowest_common_taxonomy</span><span class="p">(</span><span class="n">taxopaths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find lowest common taxonomy among set of taxopaths</span>

<span class="sd">    Args:</span>
<span class="sd">        taxopaths (list[str]): list of taxopath strings</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: lowest common taxopaht</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">taxopaths</span><span class="p">])</span>
    <span class="n">taxlevels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;d__&quot;</span><span class="p">,</span> <span class="s2">&quot;p__&quot;</span><span class="p">,</span> <span class="s2">&quot;c__&quot;</span><span class="p">,</span> <span class="s2">&quot;o__&quot;</span><span class="p">,</span> <span class="s2">&quot;f__&quot;</span><span class="p">,</span> <span class="s2">&quot;g__&quot;</span><span class="p">,</span> <span class="s2">&quot;s__&quot;</span><span class="p">]</span>
    <span class="n">lowest_tax</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tax_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">taxlevels</span><span class="p">):</span>
        <span class="n">taxa</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxa</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lowest_tax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lowest_tax</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.taxonomy.TaxonomyCounter" class="doc doc-heading">
        <code>TaxonomyCounter</code>


</h2>


  <div class="doc doc-contents ">



        <details class="quote">
          <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxonomyCounter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxopath_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tools to summarize taxonomical diversity in a list of taxopaths</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">taxodicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">Taxopath</span><span class="p">(</span><span class="n">taxopath_str</span><span class="p">)</span><span class="o">.</span><span class="n">taxodict</span> <span class="k">for</span> <span class="n">taxopath_str</span> <span class="ow">in</span> <span class="n">taxopath_list</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taxohits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">taxodicts</span><span class="p">)</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">taxlevel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;family&quot;</span><span class="p">,</span>
        <span class="n">output_tsv</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
        <span class="n">output_pdf</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute counts and fraction at specified taxonomy levels</span>

<span class="sd">        Args:</span>
<span class="sd">            taxlevel (str, optional): tanoxomy level to perform counts at.</span>
<span class="sd">                Defaults to &quot;family&quot;.</span>
<span class="sd">            output_tsv (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">            plot_type (str, optional): choose either &quot;bar&quot; or &quot;pie&quot;. Defaults to &quot;bar&quot;.</span>
<span class="sd">            output_pdf (Path, optional): path to output pdf with figures.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: dataframe with counts and fraction at specified taxlevel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxohits</span><span class="p">[</span><span class="n">taxlevel</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Merge counts from &quot;Unspecified&quot; and empty tax level, e.g., &quot;f__&quot;</span>
        <span class="n">matched_row</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="s2">&quot;[a-zA-Z]__&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">empty_tax_level</span> <span class="o">=</span> <span class="n">matched_row</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;Unspecified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;Unspecified&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="n">empty_tax_level</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">empty_tax_level</span><span class="p">)</span>

        <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">taxlevel</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;counts&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">output_tsv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_pdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counts</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span>
                <span class="n">plot_type</span><span class="o">=</span><span class="n">plot_type</span><span class="p">,</span>
                <span class="n">output_pdf</span><span class="o">=</span><span class="n">output_pdf</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Taxonomy at level: </span><span class="si">{</span><span class="n">taxlevel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">count_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">output_pdf</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make (and optionally export) barplot (&#39;bar&#39;) or pieplot (&#39;pie&#39;)</span>
<span class="sd">        figure depicting counting results at specified taxonomic level</span>

<span class="sd">        Args:</span>
<span class="sd">            count_data (pd.DataFrame): dataframe with counts and fraction</span>
<span class="sd">                at specified taxonomy level as returned by get_counts()</span>
<span class="sd">            plot_type (str, optional): choose between &quot;bar&quot; and &quot;pie&quot;.</span>
<span class="sd">                Defaults to &quot;bar&quot;.</span>
<span class="sd">            output_pdf (Path, optional): path to output pdf containing figure.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            title (str, optional): figure title. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;pie&quot;</span><span class="p">:</span>
            <span class="n">count_data</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">rotatelabels</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_pdf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count_data</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_pdf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyCounter.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">taxopath_list</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Tools to summarize taxonomical diversity in a list of taxopaths</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxopath_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tools to summarize taxonomical diversity in a list of taxopaths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">taxodicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">Taxopath</span><span class="p">(</span><span class="n">taxopath_str</span><span class="p">)</span><span class="o">.</span><span class="n">taxodict</span> <span class="k">for</span> <span class="n">taxopath_str</span> <span class="ow">in</span> <span class="n">taxopath_list</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_taxohits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">taxodicts</span><span class="p">)</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Unspecified&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyCounter.get_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_counts</span><span class="p">(</span><span class="n">taxlevel</span><span class="o">=</span><span class="s1">&#39;family&#39;</span><span class="p">,</span> <span class="n">output_tsv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">output_pdf</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compute counts and fraction at specified taxonomy levels</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>taxlevel</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>tanoxomy level to perform counts at.
Defaults to "family".</p></td>
          <td>
                <code>&#39;family&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_tsv</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>plot_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose either "bar" or "pie". Defaults to "bar".</p></td>
          <td>
                <code>&#39;bar&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_pdf</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output pdf with figures.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>None</code>
          </td>
          <td><p>pd.DataFrame: dataframe with counts and fraction at specified taxlevel</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_counts</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">taxlevel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;family&quot;</span><span class="p">,</span>
    <span class="n">output_tsv</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="n">output_pdf</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute counts and fraction at specified taxonomy levels</span>

<span class="sd">    Args:</span>
<span class="sd">        taxlevel (str, optional): tanoxomy level to perform counts at.</span>
<span class="sd">            Defaults to &quot;family&quot;.</span>
<span class="sd">        output_tsv (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        plot_type (str, optional): choose either &quot;bar&quot; or &quot;pie&quot;. Defaults to &quot;bar&quot;.</span>
<span class="sd">        output_pdf (Path, optional): path to output pdf with figures.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: dataframe with counts and fraction at specified taxlevel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxohits</span><span class="p">[</span><span class="n">taxlevel</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Merge counts from &quot;Unspecified&quot; and empty tax level, e.g., &quot;f__&quot;</span>
    <span class="n">matched_row</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="s2">&quot;[a-zA-Z]__&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">empty_tax_level</span> <span class="o">=</span> <span class="n">matched_row</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;Unspecified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;Unspecified&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="n">empty_tax_level</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">empty_tax_level</span><span class="p">)</span>

    <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">taxlevel</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;counts&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">output_tsv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output_pdf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_counts</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">plot_type</span><span class="o">=</span><span class="n">plot_type</span><span class="p">,</span>
            <span class="n">output_pdf</span><span class="o">=</span><span class="n">output_pdf</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Taxonomy at level: </span><span class="si">{</span><span class="n">taxlevel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.TaxonomyCounter.plot_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_counts</span><span class="p">(</span><span class="n">count_data</span><span class="p">,</span> <span class="n">output_pdf</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Make (and optionally export) barplot ('bar') or pieplot ('pie')
figure depicting counting results at specified taxonomic level</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>count_data</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataframe with counts and fraction
at specified taxonomy level as returned by get_counts()</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>plot_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose between "bar" and "pie".
Defaults to "bar".</p></td>
          <td>
                <code>&#39;bar&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>output_pdf</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output pdf containing figure.
Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>figure title. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_counts</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">count_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">output_pdf</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make (and optionally export) barplot (&#39;bar&#39;) or pieplot (&#39;pie&#39;)</span>
<span class="sd">    figure depicting counting results at specified taxonomic level</span>

<span class="sd">    Args:</span>
<span class="sd">        count_data (pd.DataFrame): dataframe with counts and fraction</span>
<span class="sd">            at specified taxonomy level as returned by get_counts()</span>
<span class="sd">        plot_type (str, optional): choose between &quot;bar&quot; and &quot;pie&quot;.</span>
<span class="sd">            Defaults to &quot;bar&quot;.</span>
<span class="sd">        output_pdf (Path, optional): path to output pdf containing figure.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        title (str, optional): figure title. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;pie&quot;</span><span class="p">:</span>
        <span class="n">count_data</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">rotatelabels</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_pdf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">count_data</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">90</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_pdf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.taxonomy.Taxopath" class="doc doc-heading">
        <code>Taxopath</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Object to contain taxopath</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Taxopath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object to contain taxopath</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxopath_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            taxopath_str (str, optional): taxopath as a string. Defaults to None.</span>
<span class="sd">            delimiter (str, optional): taxa delimiter in taxopath. Defaults to &quot;;&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taxopath</span> <span class="o">=</span> <span class="n">taxopath_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tax_levels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;domain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phylum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;class&quot;</span><span class="p">,</span>
            <span class="s2">&quot;order&quot;</span><span class="p">,</span>
            <span class="s2">&quot;family&quot;</span><span class="p">,</span>
            <span class="s2">&quot;genus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;species&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taxodict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_from_taxopath</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_dict_from_taxopath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxopath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">taxolist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">taxolist</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taxopath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="p">)]</span>
        <span class="n">taxolist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_levels</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxolist</span><span class="p">))])</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">taxlevel</span><span class="p">:</span> <span class="n">taxon</span> <span class="k">for</span> <span class="n">taxlevel</span><span class="p">,</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tax_levels</span><span class="p">,</span> <span class="n">taxolist</span><span class="p">)}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">taxodict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Taxopath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate Taxopath object from dict</span>

<span class="sd">        Args:</span>
<span class="sd">            taxodict (dict): dict of taxonomic levels and taxa</span>
<span class="sd">            delimiter (str, optional): delimiter to separate taxon levels.</span>
<span class="sd">                Defaults to &quot;;&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Taxopath: Taxopath object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">taxa</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="n">taxodict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">taxon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">taxa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxon</span><span class="p">)</span>
        <span class="n">taxostr</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taxa</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">taxopath_str</span><span class="o">=</span><span class="n">taxostr</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.Taxopath.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">taxopath_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p><em>summary</em></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>taxopath_str</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>taxopath as a string. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>delimiter</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>taxa delimiter in taxopath. Defaults to ";".</p></td>
          <td>
                <code>&#39;;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxopath_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        taxopath_str (str, optional): taxopath as a string. Defaults to None.</span>
<span class="sd">        delimiter (str, optional): taxa delimiter in taxopath. Defaults to &quot;;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_taxopath</span> <span class="o">=</span> <span class="n">taxopath_str</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tax_levels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;domain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;phylum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;class&quot;</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span><span class="p">,</span>
        <span class="s2">&quot;family&quot;</span><span class="p">,</span>
        <span class="s2">&quot;genus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;species&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">taxodict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_from_taxopath</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.taxonomy.Taxopath.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">taxodict</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Instantiate Taxopath object from dict</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>taxodict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dict of taxonomic levels and taxa</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>delimiter</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>delimiter to separate taxon levels.
Defaults to ";".</p></td>
          <td>
                <code>&#39;;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Taxopath</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="src.metatag.taxonomy.Taxopath" href="#src.metatag.taxonomy.Taxopath">Taxopath</a></code>
          </td>
          <td><p>Taxopath object</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/taxonomy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">taxodict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Taxopath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiate Taxopath object from dict</span>

<span class="sd">    Args:</span>
<span class="sd">        taxodict (dict): dict of taxonomic levels and taxa</span>
<span class="sd">        delimiter (str, optional): delimiter to separate taxon levels.</span>
<span class="sd">            Defaults to &quot;;&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Taxopath: Taxopath object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">taxa</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">taxon</span> <span class="ow">in</span> <span class="n">taxodict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">taxon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">taxa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">taxon</span><span class="p">)</span>
    <span class="n">taxostr</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">taxa</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">taxopath_str</span><span class="o">=</span><span class="n">taxostr</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="module-visualization">Module visualization</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.visualization"></a>
  <div class="doc doc-contents first">
  
      <p>Tools to visualize phylogenetic trees with and
without short read placement.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.visualization.make_feature_metadata_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_feature_metadata_table</span><span class="p">(</span><span class="n">label_dict</span><span class="p">,</span> <span class="n">output_tsv</span><span class="p">,</span> <span class="n">original_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Construct feature metadata tsv classifiying reference and
query sequences for empress
https://github.com/biocore/empress/issues/548</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>label_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary of sequence short IDs and labels.
Reference sequences should be prefixed with "ref_", and
query sequences should be prefixed with "query_".</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_tsv</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output tsv file with metadata table.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>original_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to include original
long labels in tree. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/visualization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_feature_metadata_table</span><span class="p">(</span>
    <span class="n">label_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_tsv</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">original_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct feature metadata tsv classifiying reference and</span>
<span class="sd">    query sequences for empress</span>
<span class="sd">    https://github.com/biocore/empress/issues/548</span>

<span class="sd">    Args:</span>
<span class="sd">        label_dict (dict): dictionary of sequence short IDs and labels.</span>
<span class="sd">            Reference sequences should be prefixed with &quot;ref_&quot;, and</span>
<span class="sd">            query sequences should be prefixed with &quot;query_&quot;.</span>
<span class="sd">        output_tsv (Path): path to output tsv file with metadata table.</span>
<span class="sd">        original_labels (bool, optional): whether to include original</span>
<span class="sd">            long labels in tree. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">seq_name</span> <span class="k">if</span> <span class="n">original_labels</span> <span class="k">else</span> <span class="n">seq_id</span><span class="p">:</span> <span class="s2">&quot;ref&quot;</span> <span class="k">if</span> <span class="s2">&quot;ref_&quot;</span> <span class="ow">in</span> <span class="n">seq_id</span> <span class="k">else</span> <span class="s2">&quot;query&quot;</span>
        <span class="k">for</span> <span class="n">seq_id</span><span class="p">,</span> <span class="n">seq_name</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">feature_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sequence type&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Feature ID&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_tsv</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.visualization.make_tree_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_tree_html</span><span class="p">(</span><span class="n">input_tree</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Runs empress tree-plot
empress:  https://github.com/biocore/empress</p>
      <p>input_tree (Path): path to tree in newick format
output_dir (Path, optional): path to output directory. Defaults to None.
feature_metadata (Path, optional): path to fieature metadata
    table as output by make_feature_metadata_table. Defaults to None.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/visualization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_tree_html</span><span class="p">(</span>
    <span class="n">input_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">feature_metadata</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs empress tree-plot</span>
<span class="sd">    empress:  https://github.com/biocore/empress</span>

<span class="sd">    Args:</span>
<span class="sd">    input_tree (Path): path to tree in newick format</span>
<span class="sd">    output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">    feature_metadata (Path, optional): path to fieature metadata</span>
<span class="sd">        table as output by make_feature_metadata_table. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_tree</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_tree</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">input_tree</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;empress-plot&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">feature_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">meta_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-fm </span><span class="si">{</span><span class="n">feature_metadata</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">meta_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;empress tree-plot -t </span><span class="si">{</span><span class="n">input_tree</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">meta_str</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.visualization.plot_tree_in_browser" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_tree_in_browser</span><span class="p">(</span><span class="n">input_tree</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Runs empress tree-plot and opens generated html in browser
empress: https://github.com/biocore/empress</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_tree</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tree in newick format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>feature_metadata</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to fieature metadata
table as output by make_feature_metadata_table. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/visualization.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_tree_in_browser</span><span class="p">(</span>
    <span class="n">input_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">feature_metadata</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs empress tree-plot and opens generated html in browser</span>
<span class="sd">    empress: https://github.com/biocore/empress</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tree (Path): path to tree in newick format</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        feature_metadata (Path, optional): path to fieature metadata</span>
<span class="sd">            table as output by make_feature_metadata_table. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">make_tree_html</span><span class="p">(</span><span class="n">input_tree</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">feature_metadata</span><span class="p">)</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">((</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;empress.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-utils">Module utils</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.utils"></a>
  <div class="doc doc-contents first">
  
      <p>Functions and classes for general purposes</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.metatag.utils.CommandArgs" class="doc doc-heading">
        <code>CommandArgs</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Base class to hold command line arguments.</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommandArgs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class to hold command line arguments.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.utils.ConfigParser" class="doc doc-heading">
        <code>ConfigParser</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Handle MetaTag configuration file.</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ConfigParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle MetaTag configuration file.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle MetaTag configuration file.&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file (Path): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize ConfigParser with default config file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">initialize_config_file</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">initialize_config_file</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize empty config file.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Path: path to generated config file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;input_database&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hmm_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_hmm_reference_size&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;min_sequence_length&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_sequence_length&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;output_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;translate&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;relabel&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;remove_duplicates&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;relabel_prefixes&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hmmsearch_args&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tree_method&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config_file</span>

    <span class="k">def</span> <span class="nf">get_config_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show config file path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span>

    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load config file.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: dict containing fields and values of config file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">config</span>

    <span class="k">def</span> <span class="nf">write_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write config dict to file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update config file</span>
<span class="sd">        Args:</span>
<span class="sd">            key (str): config file key name to be updated.</span>
<span class="sd">            value (str): new value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_config</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get field from config file.</span>
<span class="sd">        Args:</span>
<span class="sd">            key (str): key name to get the value from.</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: key value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Handle MetaTag configuration file."</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle MetaTag configuration file.&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (Path): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.get_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_config</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load config file.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>dict containing fields and values of config file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load config file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: dict containing fields and values of config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.get_config_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_config_path</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Show config file path.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_config_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show config file path.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.get_default_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_default_config</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize ConfigParser with default config file.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_default_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize ConfigParser with default config file.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">initialize_config_file</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.get_field" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_field</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Get field from config file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>key name to get the value from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>key value.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get field from config file.</span>
<span class="sd">    Args:</span>
<span class="sd">        key (str): key name to get the value from.</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: key value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.initialize_config_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_config_file</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize empty config file.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Path</code></td>          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to generated config file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">initialize_config_file</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize empty config file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Path: path to generated config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;input_database&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hmm_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_hmm_reference_size&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_sequence_length&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_sequence_length&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;output_directory&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;translate&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;relabel&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;remove_duplicates&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;relabel_prefixes&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hmmsearch_args&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tree_method&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config_file</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.update_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_config</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Update config file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>config file key name to be updated.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>value</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>new value.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update config file</span>
<span class="sd">    Args:</span>
<span class="sd">        key (str): config file key name to be updated.</span>
<span class="sd">        value (str): new value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_config</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.ConfigParser.write_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_config</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Write config dict to file.</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write config dict to file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.utils.DictMerger" class="doc doc-heading">
        <code>DictMerger</code>


</h2>


  <div class="doc doc-contents ">



        <details class="quote">
          <summary>Source code in <code>src/metatag/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DictMerger</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dicts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toos to merge python dictionaries into a single one</span>
<span class="sd">        Args</span>
<span class="sd">            dicts: list of dictionaries to be merged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span> <span class="o">=</span> <span class="n">dicts</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pickle_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dict_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DictMerger</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize class from list of paths to dictionaries (pickle)</span>

<span class="sd">        Args:</span>
<span class="sd">            dict_paths (list[Path]): list of paths to piclke files</span>

<span class="sd">        Returns:</span>
<span class="sd">            DictMerger: DictMerger instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">dict_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">dict_path</span> <span class="ow">in</span> <span class="n">dict_paths</span><span class="p">]</span>
        <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">read_from_pickle_file</span><span class="p">(</span><span class="n">dict_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">dict_path</span> <span class="ow">in</span> <span class="n">dict_paths</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dicts</span><span class="o">=</span><span class="n">dict_list</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_from_pickle_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;object.pkl&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load python object from pickle file</span>

<span class="sd">        Args:</span>
<span class="sd">            path_to_file (Path, optional): path to pickle file.</span>
<span class="sd">                Defaults to &quot;object.pkl&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: Python object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">in_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">python_object</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
        <span class="n">in_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">python_object</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dict_prefixes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_pickle_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge dictionaries</span>

<span class="sd">        Args:</span>
<span class="sd">            dict_prefixes (list[str], optional): list of strings containing prefixes</span>
<span class="sd">            to be added to values in each dict (optional). Defaults to None.</span>
<span class="sd">            save_pickle_path (Path, optional): _description_. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dict_prefixes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dict_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_prefixes</span> <span class="o">=</span> <span class="n">dict_prefixes</span>

        <span class="n">merged_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">dict_object</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_prefixes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_object</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">save_pickle_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_to_pickle_file</span><span class="p">(</span><span class="n">merged_dict</span><span class="p">,</span> <span class="n">save_pickle_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged_dict</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.DictMerger.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dicts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Toos to merge python dictionaries into a single one
Args
    dicts: list of dictionaries to be merged</p>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dicts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toos to merge python dictionaries into a single one</span>
<span class="sd">    Args</span>
<span class="sd">        dicts: list of dictionaries to be merged</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span> <span class="o">=</span> <span class="n">dicts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.DictMerger.from_pickle_paths" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_pickle_paths</span><span class="p">(</span><span class="n">dict_paths</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize class from list of paths to dictionaries (pickle)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dict_paths</code></td>
          <td>
                <code>list[<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>list of paths to piclke files</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DictMerger</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="src.metatag.utils.DictMerger" href="#src.metatag.utils.DictMerger">DictMerger</a></code>
          </td>
          <td><p>DictMerger instance</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_pickle_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dict_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DictMerger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize class from list of paths to dictionaries (pickle)</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_paths (list[Path]): list of paths to piclke files</span>

<span class="sd">    Returns:</span>
<span class="sd">        DictMerger: DictMerger instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">dict_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">dict_path</span> <span class="ow">in</span> <span class="n">dict_paths</span><span class="p">]</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">read_from_pickle_file</span><span class="p">(</span><span class="n">dict_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">dict_path</span> <span class="ow">in</span> <span class="n">dict_paths</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dicts</span><span class="o">=</span><span class="n">dict_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.DictMerger.merge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="n">dict_prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_pickle_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Merge dictionaries</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dict_prefixes</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of strings containing prefixes</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>save_pickle_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em>. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dict_prefixes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_pickle_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge dictionaries</span>

<span class="sd">    Args:</span>
<span class="sd">        dict_prefixes (list[str], optional): list of strings containing prefixes</span>
<span class="sd">        to be added to values in each dict (optional). Defaults to None.</span>
<span class="sd">        save_pickle_path (Path, optional): _description_. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dict_prefixes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dict_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dict_prefixes</span> <span class="o">=</span> <span class="n">dict_prefixes</span>

    <span class="n">merged_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">dict_object</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_prefixes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dict_object</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">save_pickle_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_to_pickle_file</span><span class="p">(</span><span class="n">merged_dict</span><span class="p">,</span> <span class="n">save_pickle_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.DictMerger.read_from_pickle_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_from_pickle_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;object.pkl&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load python object from pickle file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path_to_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to pickle file.
Defaults to "object.pkl".</p></td>
          <td>
                <code>&#39;object.pkl&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p>Python object</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read_from_pickle_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;object.pkl&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load python object from pickle file</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_file (Path, optional): path to pickle file.</span>
<span class="sd">            Defaults to &quot;object.pkl&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: Python object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">python_object</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
    <span class="n">in_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">python_object</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.utils.TemporaryDirectoryPath" class="doc doc-heading">
        <code>TemporaryDirectoryPath</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Custom context manager to create a temporary directory
which is removed when exiting context manager</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TemporaryDirectoryPath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom context manager to create a temporary directory</span>
<span class="sd">    which is removed when exiting context manager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom context manager to create a temporary directory</span>
<span class="sd">           which is removed when exiting context manager</span>

<span class="sd">        Args:</span>
<span class="sd">            work_dir (Path, optional): path to working directory. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;temp_</span><span class="si">{</span><span class="n">temp_id</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;temp_</span><span class="si">{</span><span class="n">temp_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.TemporaryDirectoryPath.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Custom context manager to create a temporary directory
   which is removed when exiting context manager</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to working directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom context manager to create a temporary directory</span>
<span class="sd">       which is removed when exiting context manager</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (Path, optional): path to working directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.metatag.utils.TemporaryFilePath" class="doc doc-heading">
        <code>TemporaryFilePath</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Custom context manager to create a temporary file
which is removed when exiting context manager</p>


        <details class="quote">
          <summary>Source code in <code>src/metatag/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TemporaryFilePath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom context manager to create a temporary file</span>
<span class="sd">    which is removed when exiting context manager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom context manager to create a temporary file</span>
<span class="sd">           which is removed when exiting context manager</span>

<span class="sd">        Args:</span>
<span class="sd">            work_dir (Path, optional): path to working directory. Defaults to None.</span>
<span class="sd">            extension (str, optional): file extension. Defaults to None.</span>
<span class="sd">            create_file (bool, optional): whether to create a permanent file.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_file</span> <span class="o">=</span> <span class="n">create_file</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">temp_file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;temp_</span><span class="si">{</span><span class="n">temp_id</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">/</span> <span class="n">temp_file_name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_file_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="src.metatag.utils.TemporaryFilePath.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Custom context manager to create a temporary file
   which is removed when exiting context manager</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to working directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>extension</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>file extension. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>create_file</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to create a permanent file.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom context manager to create a temporary file</span>
<span class="sd">       which is removed when exiting context manager</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (Path, optional): path to working directory. Defaults to None.</span>
<span class="sd">        extension (str, optional): file extension. Defaults to None.</span>
<span class="sd">        create_file (bool, optional): whether to create a permanent file.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_file</span> <span class="o">=</span> <span class="n">create_file</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.easy_pattern_matching" class="doc doc-heading">
<code class="highlight language-python"><span class="n">easy_pattern_matching</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">left_pattern</span><span class="p">,</span> <span class="n">right_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Just straightforward string searchs between two patterns</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>srring to be searched</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>left_pattern</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>left most border pattern</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>right_pattern</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>right most border pattern. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">easy_pattern_matching</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">left_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">right_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Just straightforward string searchs between two patterns</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): srring to be searched</span>
<span class="sd">        left_pattern (str): left most border pattern</span>
<span class="sd">        right_pattern (str, optional): right most border pattern. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx1</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">left_pattern</span><span class="p">)</span>
    <span class="n">left_subtext</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">idx1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_pattern</span><span class="p">)</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="n">right_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="n">left_subtext</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">right_pattern</span><span class="p">)</span>
        <span class="n">matched_text</span> <span class="o">=</span> <span class="n">left_subtext</span><span class="p">[:</span><span class="n">idx2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">matched_text</span> <span class="o">=</span> <span class="n">left_subtext</span>
    <span class="k">return</span> <span class="n">matched_text</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.init_logger" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_logger</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initialize logger object</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>args</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="src.metatag.utils.CommandArgs" href="#src.metatag.utils.CommandArgs">CommandArgs</a>, <span title="argparse.ArgumentParser">ArgumentParser</span>]</code>
          </td>
          <td><p>arguments object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>logging.Logger: initialized logger object</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_logger</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommandArgs</span><span class="p">,</span> <span class="n">ArgumentParser</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize logger object</span>
<span class="sd">    Args:</span>
<span class="sd">        args (Union[CommandArgs, ArgumentParser]): arguments object</span>
<span class="sd">    Returns:</span>
<span class="sd">        logging.Logger: initialized logger object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">logfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">logfile</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">logfile</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">ClosingFileHandler</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">logfile</span><span class="p">),</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)],</span>
        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.parallelize_over_input_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parallelize_over_input_files</span><span class="p">(</span><span class="nb">callable</span><span class="p">,</span> <span class="n">input_list</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">callable_kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Parallelize callable over a set of input objects using a pool
of workers. Inputs in input list are passed to the first argument
of the callable. Additional callable named arguments may be passed.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>callable</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>function to be called.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of input objects to callable.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_processes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of processes. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parallelize_over_input_files</span><span class="p">(</span>
    <span class="nb">callable</span><span class="p">,</span> <span class="n">input_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">callable_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallelize callable over a set of input objects using a pool</span>
<span class="sd">    of workers. Inputs in input list are passed to the first argument</span>
<span class="sd">    of the callable. Additional callable named arguments may be passed.</span>

<span class="sd">    Args:</span>
<span class="sd">        callable (_type_): function to be called.</span>
<span class="sd">        input_list (list): list of input objects to callable.</span>
<span class="sd">        n_processes (int, optional): maximum number of processes. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">processes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="nb">callable</span><span class="p">,</span> <span class="o">**</span><span class="n">callable_kwargs</span><span class="p">),</span> <span class="n">input_list</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.read_from_pickle_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_from_pickle_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;object.pkl&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load python object from pickle file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path_to_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to picke file. Defaults to "object.pkl".</p></td>
          <td>
                <code>&#39;object.pkl&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p>Python object.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_from_pickle_file</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;object.pkl&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load python object from pickle file.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_file (Path, optional): path to picke file. Defaults to &quot;object.pkl&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: Python object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">python_object</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">python_object</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.save_to_pickle_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_to_pickle_file</span><span class="p">(</span><span class="n">python_object</span><span class="p">,</span> <span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;object.pkl&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Save python object to pickle file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>python_object</code></td>
          <td>
                <code>object</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>path_to_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p><em>description</em>. Defaults to "object.pkl".</p></td>
          <td>
                <code>&#39;object.pkl&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_to_pickle_file</span><span class="p">(</span><span class="n">python_object</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">path_to_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;object.pkl&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save python object to pickle file</span>

<span class="sd">    Args:</span>
<span class="sd">        python_object (object): _description_</span>
<span class="sd">        path_to_file (Path, optional): _description_. Defaults to &quot;object.pkl&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">python_object</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.set_default_output_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_basename</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Utility function to generate a default path to output file
or directory based on an input file name and path.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tag</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text tag to be added to file name. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>extension</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>change input file extension with this one. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>only_filename</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>output only default filename. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>only_basename</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>output only default basename (no extension). Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>only_dirname</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>output only path to default output directory. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Path</code></td>          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>a path or name to a default output file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_default_output_path</span><span class="p">(</span>
    <span class="n">input_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">only_filename</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">only_basename</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">only_dirname</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utility function to generate a default path to output file</span>
<span class="sd">    or directory based on an input file name and path.</span>
<span class="sd">    Args:</span>
<span class="sd">        input_path (Path): path to input file.</span>
<span class="sd">        tag (str, optional): text tag to be added to file name. Defaults to None.</span>
<span class="sd">        extension (str, optional): change input file extension with this one. Defaults to None.</span>
<span class="sd">        only_filename (bool, optional): output only default filename. Defaults to False.</span>
<span class="sd">        only_basename (bool, optional): output only default basename (no extension). Defaults to False.</span>
<span class="sd">        only_dirname (bool, optional): output only path to default output directory. Defaults to False.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Path: a path or name to a default output file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">input_path</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">ext</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">default_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}{</span><span class="n">tag</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">only_basename</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">only_filename</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">default_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">only_dirname</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dirname</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dirname</span> <span class="o">/</span> <span class="n">default_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.utils.terminal_execute" class="doc doc-heading">
<code class="highlight language-python"><span class="n">terminal_execute</span><span class="p">(</span><span class="n">command_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Execute given command in terminal through Python.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>command_str</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>terminal command to be executed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>suppress_shell_output</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>suppress shell output. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>change working directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>return_output</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to return execution output. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>subprocess.<span title="subprocess.STDOUT">STDOUT</span></code>
          </td>
          <td><p>subprocess.STDOUT: subprocess output.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">terminal_execute</span><span class="p">(</span>
    <span class="n">command_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute given command in terminal through Python.</span>
<span class="sd">    Args:</span>
<span class="sd">        command_str (str): terminal command to be executed.</span>
<span class="sd">        suppress_shell_output (bool, optional): suppress shell output. Defaults to False.</span>
<span class="sd">        work_dir (Path, optional): change working directory. Defaults to None.</span>
<span class="sd">        return_output (bool, optional): whether to return execution output. Defaults to False.</span>
<span class="sd">    Returns:</span>
<span class="sd">        subprocess.STDOUT: subprocess output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">suppress_shell_output</span><span class="p">:</span>
        <span class="n">command_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command_str</span><span class="si">}</span><span class="s2"> &gt;/dev/null 2&gt;&amp;1&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command_str</span> <span class="o">=</span> <span class="n">command_str</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">command_str</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="n">return_output</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="module-wrappers">Module wrappers</h2>


<div class="doc doc-object doc-module">


<a id="src.metatag.wrappers"></a>
  <div class="doc doc-contents first">
  
      <p>Simple CLI wrappers to several tools</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.get_percent_identity_from_msa" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_percent_identity_from_msa</span><span class="p">(</span><span class="n">input_msa</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Run esl-alipid to compute pairwise PI from a MSA.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_msa</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input MSA file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_percent_identity_from_msa</span><span class="p">(</span><span class="n">input_msa</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run esl-alipid to compute pairwise PI from a MSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_msa (Path): path to input MSA file</span>
<span class="sd">        output_file (Path, optional): path to output file.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_msa</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_msa</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_msa</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_PI&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;esl-alipid </span><span class="si">{</span><span class="n">input_msa</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.remove_auxiliary_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_auxiliary_output</span><span class="p">(</span><span class="n">output_prefix</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Removes iqtree auxiliary output files</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix of output files</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_auxiliary_output</span><span class="p">(</span><span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes iqtree auxiliary output files</span>

<span class="sd">    Args:</span>
<span class="sd">        output_prefix (str): prefix of output files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exts_to_remove</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;.bionj&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.ckp.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.iqtree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.log&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.model.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.splits.nex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;.mldist&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">files_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">output_prefix</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">exts_to_remove</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_remove</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_cdhit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_cdhit</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to cd-hit to obtain representative sequences
CD-HIT may be used to remove duplicated sequences (keeps one representative)
with parameters -c 1 -t 1.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to cdhit.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_cdhit</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to cd-hit to obtain representative sequences</span>
<span class="sd">    CD-HIT may be used to remove duplicated sequences (keeps one representative)</span>
<span class="sd">    with parameters -c 1 -t 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input fasta file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to cdhit.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;_cdhit&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cd-hit -i </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">output_fasta</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">additional_args</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_epang" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_epang</span><span class="p">(</span><span class="n">input_tree</span><span class="p">,</span> <span class="n">input_aln_ref</span><span class="p">,</span> <span class="n">input_aln_query</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite_previous_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to EPA-ng
See epa-ng -h for additional parameters
input_tree: newick format
input_aln: fasta format
input_aln_query: fasta format (sequences must be alignned to reference
msa fasta and have the same length as the reference msa alignment)
epa-ng: https://github.com/Pbdas/epa-ng</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_tree</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tree file in newick format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_aln_ref</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference alignment in fasta format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_aln_query</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query alignment in fasta format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>substitution model employed to infer tree.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_threads</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of processes. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>overwrite_previous_results</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to overwrite result
files of a previous run. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to epa-ng. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_epang</span><span class="p">(</span>
    <span class="n">input_tree</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_aln_ref</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_aln_query</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">overwrite_previous_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to EPA-ng</span>
<span class="sd">    See epa-ng -h for additional parameters</span>
<span class="sd">    input_tree: newick format</span>
<span class="sd">    input_aln: fasta format</span>
<span class="sd">    input_aln_query: fasta format (sequences must be alignned to reference</span>
<span class="sd">    msa fasta and have the same length as the reference msa alignment)</span>
<span class="sd">    epa-ng: https://github.com/Pbdas/epa-ng</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tree (Path): path to tree file in newick format</span>
<span class="sd">        input_aln_ref (Path): path to reference alignment in fasta format</span>
<span class="sd">        input_aln_query (Path): path to query alignment in fasta format</span>
<span class="sd">        model (str, optional): substitution model employed to infer tree.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        n_threads (int, optional): maximum number of processes. Defaults to None.</span>
<span class="sd">        overwrite_previous_results (bool, optional): whether to overwrite result</span>
<span class="sd">            files of a previous run. Defaults to True.</span>
<span class="sd">        additional_args (str, optional): additional arguments to epa-ng. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_tree</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_tree</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_aln_ref</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_aln_ref</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_aln_query</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_aln_query</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">input_tree</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;GTR+G&quot;</span>
    <span class="k">if</span> <span class="n">processes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">overwrite_previous_results</span><span class="p">:</span>
        <span class="n">overwrite_str</span> <span class="o">=</span> <span class="s2">&quot;--redo&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overwrite_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;epa-ng --ref-msa </span><span class="si">{</span><span class="n">input_aln_ref</span><span class="si">}</span><span class="s2"> --tree </span><span class="si">{</span><span class="n">input_tree</span><span class="si">}</span><span class="s2"> --query </span><span class="si">{</span><span class="n">input_aln_query</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;--model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> --threads </span><span class="si">{</span><span class="n">processes</span><span class="si">}</span><span class="s2"> --outdir </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">overwrite_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_fasttree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_fasttree</span><span class="p">(</span><span class="n">input_algns</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nucleotides</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">starting_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to fasttree.
fasttree accepts multiple alignments in fasta or phylip formats
It seems that fasttree does not allow inputing subsitution model.
Default substitution model for protein seqs is JTT</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_algns</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nucleotides</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether data is DNA. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>starting_tree</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to starting tree to help inference.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to fasttree.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_fasttree</span><span class="p">(</span>
    <span class="n">input_algns</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nucleotides</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">starting_tree</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to fasttree.</span>
<span class="sd">    fasttree accepts multiple alignments in fasta or phylip formats</span>
<span class="sd">    It seems that fasttree does not allow inputing subsitution model.</span>
<span class="sd">    Default substitution model for protein seqs is JTT</span>

<span class="sd">    Args:</span>
<span class="sd">        input_algns (Path): path to input fasta file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        nucleotides (bool, optional): whether data is DNA. Defaults to False.</span>
<span class="sd">        starting_tree (str, optional): path to starting tree to help inference.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to fasttree.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_algns</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_algns</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_algns</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_fasttree&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.newick&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nucleotides</span><span class="p">:</span>
        <span class="n">nt_str</span> <span class="o">=</span> <span class="s2">&quot;-gtr -nt&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nt_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">starting_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_t_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-intree </span><span class="si">{</span><span class="n">starting_tree</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_t_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">+=</span> <span class="s2">&quot; -quiet&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fasttree </span><span class="si">{</span><span class="n">additional_args</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nt_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_algns</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">start_t_str</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_gappa_assign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_gappa_assign</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">taxonomy_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_best_hit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete_output_tree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Use gappa examine assign to assign taxonomy to placed query sequences
based on taxonomy assigned to tree reference sequences</p>
<p>argument: --resolve-missing-paths alongside --root-outgroup can be
added to find missing taxonomic info in labels.</p>
<p>Info: https://github.com/lczech/gappa/wiki/Subcommand:-assign</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>jplace</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to jplace file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxonomy_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to taxonomy file as required by gappa assign</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to be added to output files.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>only_best_hit</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>return only best hit (highest LWR).
Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to gappa assign.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>delete_output_tree</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to delete gappa assign
output tree. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_gappa_assign</span><span class="p">(</span>
    <span class="n">jplace</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">taxonomy_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">only_best_hit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delete_output_tree</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use gappa examine assign to assign taxonomy to placed query sequences</span>
<span class="sd">    based on taxonomy assigned to tree reference sequences</span>

<span class="sd">    argument: --resolve-missing-paths alongside --root-outgroup can be</span>
<span class="sd">    added to find missing taxonomic info in labels.</span>

<span class="sd">    Info: https://github.com/lczech/gappa/wiki/Subcommand:-assign</span>

<span class="sd">    Args:</span>
<span class="sd">        jplace (Path): path to jplace file</span>
<span class="sd">        taxonomy_file (Path): path to taxonomy file as required by gappa assign</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        output_prefix (str, optional): prefix to be added to output files.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        only_best_hit (bool, optional): return only best hit (highest LWR).</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        additional_args (str, optional): additional arguments to gappa assign.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        delete_output_tree (bool, optional): whether to delete gappa assign</span>
<span class="sd">            output tree. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jplace</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">jplace</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">taxonomy_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">taxonomy_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_prefix</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">jplace</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">only_best_hit</span><span class="p">:</span>
        <span class="n">best_str</span> <span class="o">=</span> <span class="s2">&quot;--best-hit&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">best_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;gappa examine assign --jplace-path </span><span class="si">{</span><span class="n">jplace</span><span class="si">}</span><span class="s2"> --taxon-file </span><span class="si">{</span><span class="n">taxonomy_file</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;--out-dir </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2"> --file-prefix </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2"> --allow-file-overwriting &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;--per-query-results </span><span class="si">{</span><span class="n">best_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">outtree</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">labelled_tree.newick&quot;</span>
    <span class="k">if</span> <span class="n">delete_output_tree</span><span class="p">:</span>
        <span class="n">outtree</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_gappa_graft" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_gappa_graft</span><span class="p">(</span><span class="n">input_jplace</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Run gappa examine graft to obtain tree with placements in
newick format</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_jplace</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to jplace file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to be added to output files.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to gappa. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_gappa_graft</span><span class="p">(</span>
    <span class="n">input_jplace</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run gappa examine graft to obtain tree with placements in</span>
<span class="sd">    newick format</span>

<span class="sd">    Args:</span>
<span class="sd">        input_jplace (Path): path to jplace file</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        output_prefix (str, optional): prefix to be added to output files.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to gappa. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_jplace</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_jplace</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outdir_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outdir_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--out-dir </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">output_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_prefix_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_prefix_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--file-prefix </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>

    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;gappa examine graft --jplace-path </span><span class="si">{</span><span class="n">input_jplace</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">output_prefix_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_hmmalign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_hmmalign</span><span class="p">(</span><span class="n">input_hmm</span><span class="p">,</span> <span class="n">input_aln</span><span class="p">,</span> <span class="n">input_seqs</span><span class="p">,</span> <span class="n">output_aln_seqs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to hmmalign
Align short read query sequences to reference MSA</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_hmm</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input hmm</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_seqs</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input sequences to be aligned</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_aln_seqs</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output alignment.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to hmmalign.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_hmmalign</span><span class="p">(</span>
    <span class="n">input_hmm</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_aln</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_seqs</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_aln_seqs</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to hmmalign</span>
<span class="sd">    Align short read query sequences to reference MSA</span>

<span class="sd">    Args:</span>
<span class="sd">        input_hmm (Path): path to input hmm</span>
<span class="sd">        input_aln (Path): path to input alignment file</span>
<span class="sd">        input_seqs (Path): path to input sequences to be aligned</span>
<span class="sd">        output_aln_seqs (Path, optional): path to output alignment.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to hmmalign.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_hmm</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_hmm</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_aln</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_aln</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_seqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_seqs</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_aln_seqs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_aln_seqs</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_seqs</span><span class="p">,</span> <span class="s2">&quot;_hmm&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.aln&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_aln_seqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_aln_seqs</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;hmmalign -o </span><span class="si">{</span><span class="n">output_aln_seqs</span><span class="si">}</span><span class="s2"> --mapali </span><span class="si">{</span><span class="n">input_aln</span><span class="si">}</span><span class="s2"> --trim &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;--informat fasta </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_hmm</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_seqs</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_hmmbuild" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_hmmbuild</span><span class="p">(</span><span class="n">input_aln</span><span class="p">,</span> <span class="n">output_hmm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to hmmbuild (build HMM profile from MSA file)
additional args: see hmmbuild -h</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input alignment file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_hmm</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output hmm. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to hmmbuild.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_hmmbuild</span><span class="p">(</span>
    <span class="n">input_aln</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_hmm</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to hmmbuild (build HMM profile from MSA file)</span>
<span class="sd">    additional args: see hmmbuild -h</span>

<span class="sd">    Args:</span>
<span class="sd">        input_aln (Path): path to input alignment file</span>
<span class="sd">        output_hmm (Path, optional): path to output hmm. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to hmmbuild.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_aln</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_aln</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_hmm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_hmm</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_aln</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.hmm&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_hmm</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_hmm</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hmmbuild </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">output_hmm</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_aln</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_hmmsearch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_hmmsearch</span><span class="p">(</span><span class="n">hmm_model</span><span class="p">,</span> <span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;hmmsearch&#39;</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to hmmsearch or hmmscan</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hmm_model</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to hmm model</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>choose method: "hmmscan" or "hmmsearcg".
Defaults to "hmmsearch".</p></td>
          <td>
                <code>&#39;hmmsearch&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>n_processes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of processes. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to hmmsearch/scan.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_hmmsearch</span><span class="p">(</span>
    <span class="n">hmm_model</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;hmmsearch&quot;</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to hmmsearch or hmmscan</span>

<span class="sd">    Args:</span>
<span class="sd">        hmm_model (Path): path to hmm model</span>
<span class="sd">        input_fasta (Path): path to input fasta file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        method (str, optional): choose method: &quot;hmmscan&quot; or &quot;hmmsearcg&quot;.</span>
<span class="sd">            Defaults to &quot;hmmsearch&quot;.</span>
<span class="sd">        n_processes (int, optional): maximum number of processes. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to hmmsearch/scan.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hmm_model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">hmm_model</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="s2">&quot;_hmmer_hits&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">processes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> --tblout </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2"> --cpu </span><span class="si">{</span><span class="n">processes</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hmm_model</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_iqtree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_iqtree</span><span class="p">(</span><span class="n">input_algns</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_recovery_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nucleotides</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">substitution_model</span><span class="o">=</span><span class="s1">&#39;TEST&#39;</span><span class="p">,</span> <span class="n">starting_tree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bootstrap_replicates</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_bootstrap_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">overwrite_previous_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to iqtree.
iqtree accepts multiple alignments in fasta or phylip formats.</p>

<details class="additional_args">
  <summary>a string containing additional parameters and</summary>
  <p>parameter values to be passed to iqtree</p>
</details>      <p>output: iqtree outputs several files</p>
<p>Reducing computational time via model selection:
http://www.iqtree.org/doc/Command-Reference</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_algns</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to be added to output files.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keep_recovery_files</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to keep recovery files.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>nucleotides</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether sequence data are DNA.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>n_processes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of processes. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>substitution_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>substitution model employed to infer tree.
Defaults to "TEST".</p></td>
          <td>
                <code>&#39;TEST&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>starting_tree</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tree file with starting tree to
help inference. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>bootstrap_replicates</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of bootstrap replicates.
Defaults to 1000.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>max_bootstrap_iterations</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of bootstrap iterations.
Defaults to 1000.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>overwrite_previous_results</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to overwrite results
of a previous run. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to iqtree. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_iqtree</span><span class="p">(</span>
    <span class="n">input_algns</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keep_recovery_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nucleotides</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">substitution_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
    <span class="n">starting_tree</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bootstrap_replicates</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">max_bootstrap_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">overwrite_previous_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to iqtree.</span>
<span class="sd">    iqtree accepts multiple alignments in fasta or phylip formats.</span>

<span class="sd">    additional_args: a string containing additional parameters and</span>
<span class="sd">                     parameter values to be passed to iqtree</span>

<span class="sd">    output: iqtree outputs several files</span>

<span class="sd">    Reducing computational time via model selection:</span>
<span class="sd">    http://www.iqtree.org/doc/Command-Reference</span>

<span class="sd">    Args:</span>
<span class="sd">        input_algns (Path): path to input fasta file</span>
<span class="sd">        output_dir (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        output_prefix (str, optional): prefix to be added to output files.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        keep_recovery_files (bool, optional): whether to keep recovery files.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        nucleotides (bool, optional): whether sequence data are DNA.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        n_processes (int, optional): maximum number of processes. Defaults to None.</span>
<span class="sd">        substitution_model (str, optional): substitution model employed to infer tree.</span>
<span class="sd">            Defaults to &quot;TEST&quot;.</span>
<span class="sd">        starting_tree (Path, optional): path to tree file with starting tree to</span>
<span class="sd">            help inference. Defaults to None.</span>
<span class="sd">        bootstrap_replicates (int, optional): number of bootstrap replicates.</span>
<span class="sd">            Defaults to 1000.</span>
<span class="sd">        max_bootstrap_iterations (int, optional): maximum number of bootstrap iterations.</span>
<span class="sd">            Defaults to 1000.</span>
<span class="sd">        overwrite_previous_results (bool, optional): whether to overwrite results</span>
<span class="sd">            of a previous run. Defaults to True.</span>
<span class="sd">        additional_args (str, optional): additional arguments to iqtree. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_algns</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_algns</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">input_algns</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">input_file</span> <span class="o">=</span> <span class="n">input_algns</span><span class="o">.</span><span class="n">name</span>
        <span class="n">output_prefix</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">input_file</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="n">output_prefix_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-pre </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_prefix</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">output_prefix</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="n">output_prefix_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-pre </span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">nucleotides</span><span class="p">:</span>
        <span class="n">seq_type</span> <span class="o">=</span> <span class="s2">&quot;DNA&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">seq_type</span> <span class="o">=</span> <span class="s2">&quot;AA&quot;</span>
    <span class="k">if</span> <span class="n">processes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processes</span> <span class="o">=</span> <span class="s2">&quot;AUTO&quot;</span>
    <span class="k">if</span> <span class="n">starting_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_t_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-t </span><span class="si">{</span><span class="n">starting_tree</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_t_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">overwrite_previous_results</span><span class="p">:</span>
        <span class="n">overwrite_str</span> <span class="o">=</span> <span class="s2">&quot;-redo&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overwrite_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">+=</span> <span class="s2">&quot; --quiet&quot;</span>

    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;iqtree -s </span><span class="si">{</span><span class="n">input_algns</span><span class="si">}</span><span class="s2"> -st </span><span class="si">{</span><span class="n">seq_type</span><span class="si">}</span><span class="s2"> -nt </span><span class="si">{</span><span class="n">processes</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-m </span><span class="si">{</span><span class="n">substitution_model</span><span class="si">}</span><span class="s2"> -bb </span><span class="si">{</span><span class="n">bootstrap_replicates</span><span class="si">}</span><span class="s2"> -mset raxml &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-nm </span><span class="si">{</span><span class="n">max_bootstrap_iterations</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">start_t_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">overwrite_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">additional_args</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_recovery_files</span><span class="p">:</span>
        <span class="n">remove_auxiliary_output</span><span class="p">(</span><span class="n">output_prefix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_mafft" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_mafft</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">processes</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to mafft (MSA)</p>
<p>Manual: https://mafft.cbrc.jp/alignment/software/manual/manual.html</p>
<p>CLI examples:
mafft --globalpair --thread n in &gt; out
mafft --localpair --thread n in &gt; out
mafft --large --globalpair --thread n in &gt; out</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_threads</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of processes. Defaults to -1.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>parallel</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p><em>description</em>. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to mafft.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_mafft</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to mafft (MSA)</span>

<span class="sd">    Manual: https://mafft.cbrc.jp/alignment/software/manual/manual.html</span>

<span class="sd">    CLI examples:</span>
<span class="sd">    mafft --globalpair --thread n in &gt; out</span>
<span class="sd">    mafft --localpair --thread n in &gt; out</span>
<span class="sd">    mafft --large --globalpair --thread n in &gt; out</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input fasta file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        n_threads (int, optional): maximum number of processes. Defaults to -1.</span>
<span class="sd">        parallel (bool, optional): _description_. Defaults to True.</span>
<span class="sd">        additional_args (str, optional): additional arguments to mafft.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.fasta.aln&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
        <span class="n">thread_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--thread </span><span class="si">{</span><span class="n">processes</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">thread_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">additional_args</span> <span class="o">+=</span> <span class="s2">&quot; --quiet&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mafft </span><span class="si">{</span><span class="n">thread_str</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">additional_args</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_muscle" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_muscle</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxiters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to muscle (MSA)
muscle: https://www.drive5.com/muscle/manual/output_formats.html</p>
<p>output phylip and fasta.aln</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>maxiters</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of iterations. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to muscle. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_muscle</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">maxiters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to muscle (MSA)</span>
<span class="sd">    muscle: https://www.drive5.com/muscle/manual/output_formats.html</span>

<span class="sd">    output phylip and fasta.aln</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input fasta file</span>
<span class="sd">        output_file (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        maxiters (int, optional): maximum number of iterations. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to muscle. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">input_fasta</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.fasta.aln&quot;</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">maxiters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxiters</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">+=</span> <span class="s2">&quot; -quiet&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;muscle -in </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> -out </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-maxiters </span><span class="si">{</span><span class="n">maxiters</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_papara" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_papara</span><span class="p">(</span><span class="n">tree_nwk</span><span class="p">,</span> <span class="n">msa_phy</span><span class="p">,</span> <span class="n">query_fasta</span><span class="p">,</span> <span class="n">output_aln</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to Papara. Output lignment in fasta format</p>
<p>Run Papara to do query alignment to reference MSA and tree (required for EPA-ng)
Alignment could be done with hmmalign or muscle as well, but these tools don't
consider the tree during alignment (would this be a justified improvement over hmmalign?)</p>
<p>There seems to be a problem with enabling multithreading in papara when run as a static
executable. It looks like it has to be enabled during compilation (but compilation currently not working):
https://stackoverflow.com/questions/19618926/thread-doesnt-work-with-an-error-enable-multithreading-to-use-stdthread-ope</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tree_nwk</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to tree file in newick format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>msa_phy</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to reference alignment in phylip format</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to query fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_aln</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output alignment. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to papara. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_papara</span><span class="p">(</span>
    <span class="n">tree_nwk</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">msa_phy</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">query_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_aln</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to Papara. Output lignment in fasta format</span>

<span class="sd">    Run Papara to do query alignment to reference MSA and tree (required for EPA-ng)</span>
<span class="sd">    Alignment could be done with hmmalign or muscle as well, but these tools don&#39;t</span>
<span class="sd">    consider the tree during alignment (would this be a justified improvement over hmmalign?)</span>

<span class="sd">    There seems to be a problem with enabling multithreading in papara when run as a static</span>
<span class="sd">    executable. It looks like it has to be enabled during compilation (but compilation currently not working):</span>
<span class="sd">    https://stackoverflow.com/questions/19618926/thread-doesnt-work-with-an-error-enable-multithreading-to-use-stdthread-ope</span>

<span class="sd">    Args:</span>
<span class="sd">        tree_nwk (Path): path to tree file in newick format</span>
<span class="sd">        msa_phy (Path): path to reference alignment in phylip format</span>
<span class="sd">        query_fasta (Path): path to query fasta file</span>
<span class="sd">        output_aln (Path, optional): path to output alignment. Defaults to None.</span>
<span class="sd">        additional_args (str, optional): additional arguments to papara. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tree_nwk</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tree_nwk</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">msa_phy</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">msa_phy</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">query_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">query_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">output_aln</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_aln</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
            <span class="n">query_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_ref_aln&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.phylip&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_aln</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_aln</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">papara_exec</span><span class="si">}</span><span class="s2"> -t </span><span class="si">{</span><span class="n">tree_nwk</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-s </span><span class="si">{</span><span class="n">msa_phy</span><span class="si">}</span><span class="s2"> -q </span><span class="si">{</span><span class="n">query_fasta</span><span class="si">}</span><span class="s2"> -n phylip &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-r </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2"> -a&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
        <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="s2">&quot;papara_alignment.phylip&quot;</span><span class="p">),</span> <span class="n">output_aln</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_prodigal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_prodigal</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metagenome</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simple CLI wrapper to prodigal</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>prefix to be preppended to output files.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>output_dir</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output directory. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metagenome</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether original sequences are metagenomic.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>additional_args</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>additional arguments to prodigal.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_prodigal</span><span class="p">(</span>
    <span class="n">input_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metagenome</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">additional_args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple CLI wrapper to prodigal</span>

<span class="sd">    Args:</span>
<span class="sd">        input_file (Path): path to input file</span>
<span class="sd">        output_prefix (str, optional): prefix to be preppended to output files.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        output_dir (Path, optional): path to output directory. Defaults to None.</span>
<span class="sd">        metagenome (bool, optional): whether original sequences are metagenomic.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        additional_args (str, optional): additional arguments to prodigal.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">only_dirname</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">output_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_prefix</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">only_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metagenome</span><span class="p">:</span>
        <span class="n">procedure</span> <span class="o">=</span> <span class="s2">&quot;meta&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">procedure</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span>
    <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="n">additional_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">output_gbk</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.gbk&quot;</span>
    <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_prefix</span><span class="si">}</span><span class="s2">.faa&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;prodigal -i </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">output_gbk</span><span class="si">}</span><span class="s2"> -p </span><span class="si">{</span><span class="n">procedure</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;-a </span><span class="si">{</span><span class="n">output_fasta</span><span class="si">}</span><span class="s2"> -q </span><span class="si">{</span><span class="n">args_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.metatag.wrappers.run_seqkit_nodup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_seqkit_nodup</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">output_fasta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Simpe CLI wrapper to seqkit rmdup</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to input fasta file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_fasta</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>export_duplicates</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to export duplicated sequences.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>duplicates_file</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>path to output file containing duplicates.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/metatag/wrappers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_seqkit_nodup</span><span class="p">(</span>
    <span class="n">input_fasta</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">output_fasta</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">export_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">duplicates_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simpe CLI wrapper to seqkit rmdup</span>

<span class="sd">    Args:</span>
<span class="sd">        input_fasta (Path): path to input fasta file</span>
<span class="sd">        output_fasta (Path, optional): path to output file. Defaults to None.</span>
<span class="sd">        export_duplicates (bool, optional): whether to export duplicated sequences.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        duplicates_file (Path, optional): path to output file containing duplicates.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">output_fasta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span><span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_no_duplicates&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_fasta</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_fasta</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">export_duplicates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">duplicates_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dup_file</span> <span class="o">=</span> <span class="n">set_default_output_path</span><span class="p">(</span>
                <span class="n">input_fasta</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;_duplicates&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.txt&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dup_file</span> <span class="o">=</span> <span class="n">duplicates_file</span>
        <span class="n">dup_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;-D </span><span class="si">{</span><span class="n">dup_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dup_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seqkit rmdup </span><span class="si">{</span><span class="n">input_fasta</span><span class="si">}</span><span class="s2"> --quiet -s </span><span class="si">{</span><span class="n">dup_str</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">output_fasta</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">terminal_execute</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span> <span class="n">suppress_shell_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../subcommands/relabel/" class="btn btn-neutral float-left" title="Relabel"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Robaina/MetaTag" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../subcommands/relabel/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../javascripts/mathjax.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
